"use strict";(self.webpackChunkphysical_ai_robotics_textbook=self.webpackChunkphysical_ai_robotics_textbook||[]).push([[864],{974:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"chapter-1-ros2-fundamentals/services-actions","title":"Services and Actions: Synchronous & Long-Running Communication","description":"Introduction","source":"@site/docs/01-chapter-1-ros2-fundamentals/06-services-actions.md","sourceDirName":"01-chapter-1-ros2-fundamentals","slug":"/chapter-1-ros2-fundamentals/services-actions","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/services-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/devhammad0/physical-ai-robotics-textbook/tree/main/docs/01-chapter-1-ros2-fundamentals/06-services-actions.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Services and Actions: Synchronous & Long-Running Communication","chapter":1,"lesson":6,"duration_minutes":75,"simulation_required":["turtlesim"],"safety_level":"simulation_only","cefr_level":"B1","hardware_prerequisites":[],"learning_objectives":["Understand when to use services vs. publish-subscribe","Implement a ROS 2 service server (request-response)","Call a ROS 2 service client from another node","Understand the difference between services and actions","Implement an action server with feedback","Call an action client and handle results","Design communication patterns for different robotics tasks"],"primary_layer":"Layer 1 (Manual Foundation) + Layer 2 (AI Collaboration)"},"sidebar":"tutorialSidebar","previous":{"title":"Your First ROS 2 Subscriber","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/subscriber"},"next":{"title":"Building Multi-Node Systems & Launch Files","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/launch-files"}}');var t=r(6070),i=r(8439);const l={title:"Services and Actions: Synchronous & Long-Running Communication",chapter:1,lesson:6,duration_minutes:75,simulation_required:["turtlesim"],safety_level:"simulation_only",cefr_level:"B1",hardware_prerequisites:[],learning_objectives:["Understand when to use services vs. publish-subscribe","Implement a ROS 2 service server (request-response)","Call a ROS 2 service client from another node","Understand the difference between services and actions","Implement an action server with feedback","Call an action client and handle results","Design communication patterns for different robotics tasks"],primary_layer:"Layer 1 (Manual Foundation) + Layer 2 (AI Collaboration)"},o=void 0,c={},a=[{value:"Introduction",id:"introduction",level:2},{value:"Concept 1: Services (Request-Response)",id:"concept-1-services-request-response",level:2},{value:"Service Pattern",id:"service-pattern",level:3},{value:"When to Use Services",id:"when-to-use-services",level:3},{value:"Example: Reset Turtle",id:"example-reset-turtle",level:3},{value:"Concept 2: Service Definition",id:"concept-2-service-definition",level:2},{value:"Code Example 1: Service Server",id:"code-example-1-service-server",level:2},{value:"Code Example 2: Service Client (Call Existing Service)",id:"code-example-2-service-client-call-existing-service",level:2},{value:"How to Run",id:"how-to-run",level:3},{value:"Expected Output",id:"expected-output",level:3},{value:"Code Example 3: Service Server with Custom Service",id:"code-example-3-service-server-with-custom-service",level:2},{value:"Concept 3: Actions (Long-Running Operations)",id:"concept-3-actions-long-running-operations",level:2},{value:"Action Pattern",id:"action-pattern",level:3},{value:"When to Use Actions",id:"when-to-use-actions",level:3},{value:"Example: Navigate Robot to Pose",id:"example-navigate-robot-to-pose",level:3},{value:"Code Example 4: Action Server (Fibonacci)",id:"code-example-4-action-server-fibonacci",level:2},{value:"Code Example 5: Simple Navigation Action (Turtlesim)",id:"code-example-5-simple-navigation-action-turtlesim",level:2},{value:"Comparison Table: Pub/Sub vs. Services vs. Actions",id:"comparison-table-pubsub-vs-services-vs-actions",level:2},{value:"Troubleshooting Services and Actions",id:"troubleshooting-services-and-actions",level:2},{value:"Error: &quot;Service not available&quot;",id:"error-service-not-available",level:3},{value:"Error: &quot;ServiceException: Service not available&quot;",id:"error-serviceexception-service-not-available",level:3},{value:"Error: &quot;Action not found&quot;",id:"error-action-not-found",level:3},{value:"Error: &quot;Timeout waiting for response&quot;",id:"error-timeout-waiting-for-response",level:3},{value:"Layer 2: AI Collaboration Prompts",id:"layer-2-ai-collaboration-prompts",level:2},{value:"Prompt 1: Services vs. Topics",id:"prompt-1-services-vs-topics",level:3},{value:"Prompt 2: Action Preemption",id:"prompt-2-action-preemption",level:3},{value:"Prompt 3: Service Reliability",id:"prompt-3-service-reliability",level:3},{value:"Self-Assessment Checklist",id:"self-assessment-checklist",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(n.p,{children:["So far, you've learned about ",(0,t.jsx)(n.strong,{children:"publishers and subscribers"})," (asynchronous, one-way communication). But some robot tasks require ",(0,t.jsx)(n.strong,{children:"synchronous request-response"})," patterns:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Reset the turtle's position"}),"\n",(0,t.jsx)(n.li,{children:"Query battery status"}),"\n",(0,t.jsx)(n.li,{children:"Command robot to navigate to a location"}),"\n",(0,t.jsx)(n.li,{children:"Move a robot arm to a target pose (takes time, provide feedback)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This lesson covers two new communication patterns:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Services"}),": Synchronous, fast (request \u2192 response)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Actions"}),": Long-running, asynchronous with feedback (goal \u2192 feedback \u2192 result)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Simulation environment"}),": Turtlesim (from Lesson 2)"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Time estimate"}),": 75 minutes"]}),"\n",(0,t.jsx)(n.p,{children:"By the end, you'll understand:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When to use services vs. pub/sub vs. actions"}),"\n",(0,t.jsx)(n.li,{children:"How to implement service servers and clients"}),"\n",(0,t.jsx)(n.li,{children:"How to implement action servers and clients"}),"\n",(0,t.jsx)(n.li,{children:"Real-world patterns in robotics systems"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"concept-1-services-request-response",children:"Concept 1: Services (Request-Response)"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"service"})," is a synchronous communication pattern: Client sends a request, server immediately responds. Think of it like a function call across network boundaries."]}),"\n",(0,t.jsx)(n.h3,{id:"service-pattern",children:"Service Pattern"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Client                          Server\r\n  |                              |\r\n  |--- Request (call service)---\x3e|\r\n  |                              |\r\n  |                         Process\r\n  |                              |\r\n  |<--- Response (result) --------|\r\n  |                              |\n"})}),"\n",(0,t.jsx)(n.h3,{id:"when-to-use-services",children:"When to Use Services"}),"\n",(0,t.jsxs)(n.p,{children:["\u2713 ",(0,t.jsx)(n.strong,{children:"Use services for"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"One-time operations (don't need continuous data)"}),"\n",(0,t.jsx)(n.li,{children:"Queries (request information)"}),"\n",(0,t.jsx)(n.li,{children:"Configuration changes"}),"\n",(0,t.jsx)(n.li,{children:"State resets"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u2717 ",(0,t.jsx)(n.strong,{children:"Don't use services for"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Continuous sensor data (use topics)"}),"\n",(0,t.jsx)(n.li,{children:"High-frequency commands (use topics)"}),"\n",(0,t.jsxs)(n.li,{children:["Long operations (robot might not respond) \u2014 use ",(0,t.jsx)(n.strong,{children:"actions"})," instead"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"example-reset-turtle",children:"Example: Reset Turtle"}),"\n",(0,t.jsxs)(n.p,{children:["Turtlesim has a built-in service ",(0,t.jsx)(n.code,{children:"/reset"})," that resets the turtle:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 service call /reset std_srvs/srv/Empty\n"})}),"\n",(0,t.jsx)(n.p,{children:"This calls the service (no arguments), and the turtle resets."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"concept-2-service-definition",children:"Concept 2: Service Definition"}),"\n",(0,t.jsxs)(n.p,{children:["Services are defined in ",(0,t.jsx)(n.code,{children:".srv"})," files (like message ",(0,t.jsx)(n.code,{children:".msg"})," files):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"std_srvs/srv/Empty:\r\n  ---  (separator: request / response)\r\n  (no request fields)\r\n  (no response fields)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example with data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"geometry_msgs/srv/GetPose:\r\n  ---\r\n  (request)\r\n  int32 id\r\n  ---\r\n  (response)\r\n  geometry_msgs/Pose pose\r\n  string status\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For Turtlesim, the ",(0,t.jsx)(n.code,{children:"/turtle1/set_pen"})," service:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 service call /turtle1/set_pen turtlesim/srv/SetPen \\\r\n  '{r: 255, g: 0, b: 0, width: 3, \"off\": false}'\n"})}),"\n",(0,t.jsx)(n.p,{children:"This request has 5 fields (r, g, b, width, off); the response is empty."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"code-example-1-service-server",children:"Code Example 1: Service Server"}),"\n",(0,t.jsx)(n.p,{children:"Let's create a service server that provides turtle information."}),"\n",(0,t.jsxs)(n.p,{children:["Create: ",(0,t.jsx)(n.code,{children:"turtle_info_service.py"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"""\r\nTurtle Info Service Server\r\nSimulation environment: Turtlesim\r\nProvides turtle position and angle on request\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom turtlesim.msg import Pose\r\nfrom std_srvs.srv import GetPose  # Custom service (we\'ll create)\r\n\r\n# For now, use a simple custom service\r\n# In production, define in a .srv file\r\nclass TurtleInfo:\r\n    """Simple turtle info service"""\r\n    pass\r\n\r\n\r\nclass TurtleInfoServer(Node):\r\n    """Provides turtle position on request"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'turtle_info_server\')\r\n\r\n        # Store latest turtle pose\r\n        self.turtle_pose = Pose()\r\n\r\n        # Subscribe to turtle position\r\n        self.subscription = self.create_subscription(\r\n            Pose, \'/turtle1/pose\', self.pose_callback, 10)\r\n\r\n        # Create service server\r\n        # Note: In real code, define custom .srv file\r\n        # For this example, we use a simple pattern\r\n        self.get_logger().info(\'Turtle info service server started\')\r\n\r\n    def pose_callback(self, msg):\r\n        """Update cached turtle position"""\r\n        self.turtle_pose = msg\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TurtleInfoServer()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": Turtlesim already provides services. Let's instead create a service client that calls them."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"code-example-2-service-client-call-existing-service",children:"Code Example 2: Service Client (Call Existing Service)"}),"\n",(0,t.jsxs)(n.p,{children:["Let's create a client that calls Turtlesim's built-in ",(0,t.jsx)(n.code,{children:"/reset"})," service."]}),"\n",(0,t.jsxs)(n.p,{children:["Create: ",(0,t.jsx)(n.code,{children:"turtle_reset_client.py"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"""\r\nTurtle Reset Service Client\r\nSimulation environment: Turtlesim\r\nCalls the /reset service to reset turtle position\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_srvs.srv import Empty\r\nimport time\r\n\r\n\r\nclass TurtleResetClient(Node):\r\n    """Client that calls the reset service"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'turtle_reset_client\')\r\n\r\n        # Create client for /reset service\r\n        self.client = self.create_client(Empty, \'/reset\')\r\n\r\n        # Wait for service to be available\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info(\'Service /reset not available, waiting...\')\r\n\r\n        self.get_logger().info(\'Reset service available!\')\r\n\r\n    def send_reset_request(self):\r\n        """Call the reset service"""\r\n        request = Empty.Request()\r\n\r\n        # Call service (synchronous)\r\n        future = self.client.call_async(request)\r\n\r\n        # Wait for response\r\n        future.add_done_callback(self.reset_callback)\r\n\r\n    def reset_callback(self, future):\r\n        """Handle reset response"""\r\n        try:\r\n            response = future.result()\r\n            self.get_logger().info(\'Turtle reset successfully!\')\r\n        except Exception as e:\r\n            self.get_logger().error(f\'Reset failed: {e}\')\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TurtleResetClient()\r\n\r\n    # Wait a moment for service to be ready\r\n    time.sleep(1)\r\n\r\n    # Call reset service\r\n    node.send_reset_request()\r\n\r\n    # Spin briefly to process response\r\n    for _ in range(5):\r\n        rclpy.spin_once(node, timeout_sec=0.2)\r\n\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsx)(n.h3,{id:"how-to-run",children:"How to Run"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Turtlesim\r\nros2 run turtlesim turtlesim_node\r\n\r\n# Terminal 2: Client calls reset\r\npython3 turtle_reset_client.py\n"})}),"\n",(0,t.jsx)(n.h3,{id:"expected-output",children:"Expected Output"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[INFO] [turtle_reset_client]: Reset service available!\r\n[INFO] [turtle_reset_client]: Turtle reset successfully!\n"})}),"\n",(0,t.jsx)(n.p,{children:"The turtle will return to its starting position (5.54, 5.54)."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"code-example-3-service-server-with-custom-service",children:"Code Example 3: Service Server with Custom Service"}),"\n",(0,t.jsx)(n.p,{children:"Let's create a custom service that calculates distance to a point."}),"\n",(0,t.jsxs)(n.p,{children:["First, create the service definition file: ",(0,t.jsx)(n.code,{children:"DistanceTo.srv"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Request: target point\r\nfloat32 target_x\r\nfloat32 target_y\r\n---\r\n# Response: distance\r\nfloat32 distance\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then the server: ",(0,t.jsx)(n.code,{children:"distance_calculator_server.py"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"""\r\nDistance Calculator Service Server\r\nSimulation environment: Turtlesim\r\nCalculates distance from turtle to target point\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom turtlesim.msg import Pose\r\nimport math\r\n\r\n\r\nclass DistanceCalculator(Node):\r\n    """Calculates distance from turtle to target"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'distance_calculator\')\r\n\r\n        # Cache current turtle position\r\n        self.current_x = 5.54\r\n        self.current_y = 5.54\r\n\r\n        # Subscribe to turtle position\r\n        self.subscription = self.create_subscription(\r\n            Pose, \'/turtle1/pose\', self.pose_callback, 10)\r\n\r\n        self.get_logger().info(\'Distance calculator server started\')\r\n\r\n    def pose_callback(self, msg):\r\n        """Update turtle position"""\r\n        self.current_x = msg.x\r\n        self.current_y = msg.y\r\n\r\n    def calculate_distance(self, target_x, target_y):\r\n        """Calculate distance from turtle to target"""\r\n        dx = target_x - self.current_x\r\n        dy = target_y - self.current_y\r\n        distance = math.sqrt(dx**2 + dy**2)\r\n        return distance\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = DistanceCalculator()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"concept-3-actions-long-running-operations",children:"Concept 3: Actions (Long-Running Operations)"}),"\n",(0,t.jsxs)(n.p,{children:["An ",(0,t.jsx)(n.strong,{children:"action"})," is an asynchronous pattern for long-running tasks. Unlike services (which block waiting for response), actions:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Accept a ",(0,t.jsx)(n.strong,{children:"goal"})," from client"]}),"\n",(0,t.jsxs)(n.li,{children:["Periodically send ",(0,t.jsx)(n.strong,{children:"feedback"})," to client"]}),"\n",(0,t.jsxs)(n.li,{children:["Return a ",(0,t.jsx)(n.strong,{children:"result"})," when complete"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"action-pattern",children:"Action Pattern"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Client                              Server\r\n  |                                   |\r\n  |----- Send Goal ----\x3e|             |\r\n  |                     |  Processing |\r\n  |                     |  (provides   |\r\n  |<--- Feedback -------|   feedback  |\r\n  |                     |   periodically)\r\n  |                     |             |\r\n  |<--- Feedback -------|             |\r\n  |                     |             |\r\n  |<--- Result ---------|             |\r\n  |                     |             |\n"})}),"\n",(0,t.jsx)(n.h3,{id:"when-to-use-actions",children:"When to Use Actions"}),"\n",(0,t.jsxs)(n.p,{children:["\u2713 ",(0,t.jsx)(n.strong,{children:"Use actions for"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Long-running tasks (navigation, manipulation)"}),"\n",(0,t.jsx)(n.li,{children:"Need feedback during execution"}),"\n",(0,t.jsx)(n.li,{children:"Can be cancelled"}),"\n",(0,t.jsx)(n.li,{children:"Preemption (interrupt and restart)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u2717 ",(0,t.jsx)(n.strong,{children:"Don't use for"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Quick operations (< 1 second) \u2014 use services"}),"\n",(0,t.jsx)(n.li,{children:"Continuous monitoring \u2014 use topics"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"example-navigate-robot-to-pose",children:"Example: Navigate Robot to Pose"}),"\n",(0,t.jsx)(n.p,{children:"Navigation takes 10+ seconds. During execution:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Provide feedback: "At waypoint 2 of 5"'}),"\n",(0,t.jsx)(n.li,{children:'Provide feedback: "60% complete"'}),"\n",(0,t.jsx)(n.li,{children:'Client can cancel: "Stop navigating"'}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"code-example-4-action-server-fibonacci",children:"Code Example 4: Action Server (Fibonacci)"}),"\n",(0,t.jsx)(n.p,{children:"Let's create an action server that computes Fibonacci numbers (simulating a long task)."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": This is educational; real robots use ",(0,t.jsx)(n.code,{children:"nav2_msgs/action/NavigateToPose"})," for navigation."]}),"\n",(0,t.jsxs)(n.p,{children:["Create: ",(0,t.jsx)(n.code,{children:"fibonacci_action_server.py"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"""\r\nFibonacci Action Server\r\nSimulation environment: Any (computational task)\r\nDemonstrates action pattern: goal \u2192 feedback \u2192 result\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom rclpy.executors import MultiThreadedExecutor\r\nfrom action_tutorials_interfaces.action import Fibonacci\r\n\r\n\r\nclass FibonacciActionServer(Node):\r\n    """Action server that computes Fibonacci numbers"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'fibonacci_action_server\')\r\n\r\n        # Create action server\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,\r\n            \'fibonacci\',\r\n            self.execute_callback)\r\n\r\n        self.get_logger().info(\'Fibonacci action server started\')\r\n\r\n    async def execute_callback(self, goal_handle):\r\n        """Execute the Fibonacci action"""\r\n\r\n        self.get_logger().info(f\'Computing Fibonacci({goal_handle.request.order})\')\r\n\r\n        # Compute Fibonacci sequence\r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.sequence = [0, 1]\r\n\r\n        for i in range(1, goal_handle.request.order):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info(\'Fibonacci computation cancelled\')\r\n                return Fibonacci.Result()\r\n\r\n            # Add next Fibonacci number\r\n            feedback_msg.sequence.append(\r\n                feedback_msg.sequence[i] + feedback_msg.sequence[i - 1])\r\n\r\n            self.get_logger().info(f\'Sequence: {feedback_msg.sequence}\')\r\n\r\n            # Send feedback\r\n            goal_handle.publish_feedback(feedback_msg)\r\n\r\n        # Computation complete\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.sequence\r\n\r\n        goal_handle.succeed()\r\n\r\n        self.get_logger().info(f\'Fibonacci complete: {result.sequence}\')\r\n\r\n        return result\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n\r\n    action_server = FibonacciActionServer()\r\n\r\n    # Use MultiThreadedExecutor to handle concurrent requests\r\n    executor = MultiThreadedExecutor()\r\n\r\n    try:\r\n        rclpy.spin(action_server, executor=executor)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        action_server.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": This requires the ",(0,t.jsx)(n.code,{children:"action_tutorials_interfaces"})," package. For Turtlesim, here's a simpler example:"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"code-example-5-simple-navigation-action-turtlesim",children:"Code Example 5: Simple Navigation Action (Turtlesim)"}),"\n",(0,t.jsxs)(n.p,{children:["Create: ",(0,t.jsx)(n.code,{children:"navigate_turtle_action.py"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"""\r\nNavigate Turtle Action Server\r\nSimulation environment: Turtlesim\r\nAction: Navigate turtle to target position with feedback\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom rclpy.executors import MultiThreadedExecutor\r\nfrom geometry_msgs.msg import Twist\r\nfrom turtlesim.msg import Pose\r\nimport math\r\nimport time\r\n\r\n\r\nclass NavigateGoal:\r\n    """Simple goal structure"""\r\n    def __init__(self):\r\n        self.target_x = 0.0\r\n        self.target_y = 0.0\r\n\r\n\r\nclass NavigateTurtleServer(Node):\r\n    """Action server that navigates turtle to target"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'navigate_turtle_server\')\r\n\r\n        # Turtle state\r\n        self.current_x = 5.54\r\n        self.current_y = 5.54\r\n        self.current_theta = 0.0\r\n\r\n        # Subscribe to pose\r\n        self.subscription = self.create_subscription(\r\n            Pose, \'/turtle1/pose\', self.pose_callback, 10)\r\n\r\n        # Publisher for commands\r\n        self.publisher = self.create_publisher(\r\n            Twist, \'/turtle1/cmd_vel\', 10)\r\n\r\n        self.get_logger().info(\'Navigate turtle action server started\')\r\n\r\n    def pose_callback(self, msg):\r\n        """Update turtle position"""\r\n        self.current_x = msg.x\r\n        self.current_y = msg.y\r\n        self.current_theta = msg.theta\r\n\r\n    def navigate_to(self, target_x, target_y, timeout=10.0):\r\n        """Navigate turtle to target position"""\r\n\r\n        start_time = time.time()\r\n\r\n        while (time.time() - start_time) < timeout:\r\n            # Calculate distance to target\r\n            dx = target_x - self.current_x\r\n            dy = target_y - self.current_y\r\n            distance = math.sqrt(dx**2 + dy**2)\r\n\r\n            if distance < 0.2:\r\n                # Reached target\r\n                msg = Twist()\r\n                self.publisher.publish(msg)\r\n                return True\r\n\r\n            # Calculate direction\r\n            angle_to_target = math.atan2(dy, dx)\r\n            angle_error = angle_to_target - self.current_theta\r\n\r\n            # Normalize angle\r\n            while angle_error > math.pi:\r\n                angle_error -= 2 * math.pi\r\n            while angle_error < -math.pi:\r\n                angle_error += 2 * math.pi\r\n\r\n            # Publish command\r\n            msg = Twist()\r\n            msg.linear.x = min(1.0, distance)\r\n            msg.angular.z = angle_error\r\n\r\n            self.publisher.publish(msg)\r\n\r\n            rclpy.spin_once(self, timeout_sec=0.1)\r\n\r\n        return False\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = NavigateTurtleServer()\r\n\r\n    # Navigate to (9.0, 9.0)\r\n    success = node.navigate_to(9.0, 9.0, timeout=15.0)\r\n\r\n    if success:\r\n        node.get_logger().info(\'Navigation successful!\')\r\n    else:\r\n        node.get_logger().info(\'Navigation timeout\')\r\n\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"comparison-table-pubsub-vs-services-vs-actions",children:"Comparison Table: Pub/Sub vs. Services vs. Actions"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Pattern"}),(0,t.jsx)(n.th,{children:"Async"}),(0,t.jsx)(n.th,{children:"Sync"}),(0,t.jsx)(n.th,{children:"Feedback"}),(0,t.jsx)(n.th,{children:"Typical Use"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Pub/Sub"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Continuous sensor data, state updates"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Service"})}),(0,t.jsx)(n.td,{children:"No*"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"One-time queries, configuration"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Action"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Yes**"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Long tasks, navigation, manipulation"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"*Clients can call asynchronously but typically wait for response\r\n**Client can wait for result while server executes"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting-services-and-actions",children:"Troubleshooting Services and Actions"}),"\n",(0,t.jsx)(n.h3,{id:"error-service-not-available",children:'Error: "Service not available"'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause"}),": Server not running"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check if service exists\r\nros2 service list\r\n\r\n# Check if server is responsive\r\nros2 service call /reset std_srvs/srv/Empty\n"})}),"\n",(0,t.jsx)(n.h3,{id:"error-serviceexception-service-not-available",children:'Error: "ServiceException: Service not available"'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause"}),": Client trying to call non-existent service"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Fix in code"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# Check service exists before calling\r\nif not self.client.wait_for_service(timeout_sec=5.0):\r\n    self.get_logger().error('Service not available')\r\n    return\n"})}),"\n",(0,t.jsx)(n.h3,{id:"error-action-not-found",children:'Error: "Action not found"'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause"}),": Action server not running or wrong action name"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 action list      # See all available actions\r\nros2 action info /my_action  # Check action details\n"})}),"\n",(0,t.jsx)(n.h3,{id:"error-timeout-waiting-for-response",children:'Error: "Timeout waiting for response"'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause"}),": Service/action takes too long"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Increase timeout:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"future = self.client.call_async(request)\r\nfuture.add_done_callback(callback)  # Async: no timeout\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Move to action pattern (supports cancellation)"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"layer-2-ai-collaboration-prompts",children:"Layer 2: AI Collaboration Prompts"}),"\n",(0,t.jsx)(n.h3,{id:"prompt-1-services-vs-topics",children:"Prompt 1: Services vs. Topics"}),"\n",(0,t.jsx)(n.p,{children:"\"Ask Claude: 'When should I use a ROS 2 service instead of a topic for synchronous operations?'\""}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What you're exploring"}),": Design patterns in distributed systems"]}),"\n",(0,t.jsx)(n.h3,{id:"prompt-2-action-preemption",children:"Prompt 2: Action Preemption"}),"\n",(0,t.jsx)(n.p,{children:"\"Ask Claude: 'How do I cancel a long-running action in ROS 2? What happens to the server when the client cancels?'\""}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What you're exploring"}),": Lifecycle management in real-time systems"]}),"\n",(0,t.jsx)(n.h3,{id:"prompt-3-service-reliability",children:"Prompt 3: Service Reliability"}),"\n",(0,t.jsx)(n.p,{children:"\"Ask Claude: 'What if a service server crashes while processing a request? How does the client handle it?'\""}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"What you're exploring"}),": Fault tolerance in distributed systems"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"self-assessment-checklist",children:"Self-Assessment Checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I understand the difference between services and topics"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I can identify when to use services vs. publish-subscribe"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I can call existing ROS 2 services from a client node"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I understand the request-response pattern"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I know what actions are and when to use them"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I understand action feedback and result messages"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I can handle service timeouts and errors"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","I can design communication for a multi-node robot system"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Lesson 7"})," covers ",(0,t.jsx)(n.strong,{children:"Building Integrated Systems"}),"\u2014combining publishers, subscribers, and services into complete multi-node robotics applications."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Challenge"}),": Create a service that:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Accepts a target distance as request"}),"\n",(0,t.jsx)(n.li,{children:"Calculates how long it will take the turtle to travel that distance"}),"\n",(0,t.jsx)(n.li,{children:"Returns the estimated time as response"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"End of Lesson 6: Services and Actions"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8439:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var s=r(758);const t={},i=s.createContext(t);function l(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);