"use strict";(self.webpackChunkphysical_ai_robotics_textbook=self.webpackChunkphysical_ai_robotics_textbook||[]).push([[952],{5329:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"chapter-1-ros2-fundamentals/first-subscriber","title":"Your First Subscriber","description":"Introduction","source":"@site/docs/chapter-1-ros2-fundamentals/05-first-subscriber.md","sourceDirName":"chapter-1-ros2-fundamentals","slug":"/chapter-1-ros2-fundamentals/first-subscriber","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/first-subscriber","draft":false,"unlisted":false,"editUrl":"https://github.com/devhammad0/physical-ai-robotics-textbook/tree/main/docs/chapter-1-ros2-fundamentals/05-first-subscriber.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Your First Subscriber","sidebar_position":5,"sidebar_label":"5. First Subscriber","chapter":1,"lesson":5,"lesson_slug":"first-subscriber","duration_minutes":60,"estimated_difficulty":"beginner","simulation_required":["turtlesim"],"safety_level":"simulation_only","cefr_level":"A2","hardware_prerequisites":[],"concepts":["Subscribers","Callbacks","Message handlers","Event-driven programming","Pose data","Decoupling","Data access"],"primary_layer":"Layer 2","learning_objectives":["Create a ROS 2 subscriber in Python","Process incoming messages with callbacks","Extract data from messages","Understand the difference between publishers and subscribers","Comprehend pub/sub decoupling (loose coupling)","Create a system with both publishers and subscribers"],"assessment_type":"practical_exercise","keywords":["ROS 2","subscriber","callback","message handler","Pose","turtlesim","decoupling"]},"sidebar":"tutorialSidebar","previous":{"title":"4. Debugging ROS 2","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/debugging-ros2"},"next":{"title":"6. Multi-Node Systems","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/multi-node-systems"}}');var i=n(6070),t=n(8439);const l={title:"Your First Subscriber",sidebar_position:5,sidebar_label:"5. First Subscriber",chapter:1,lesson:5,lesson_slug:"first-subscriber",duration_minutes:60,estimated_difficulty:"beginner",simulation_required:["turtlesim"],safety_level:"simulation_only",cefr_level:"A2",hardware_prerequisites:[],concepts:["Subscribers","Callbacks","Message handlers","Event-driven programming","Pose data","Decoupling","Data access"],primary_layer:"Layer 2",learning_objectives:["Create a ROS 2 subscriber in Python","Process incoming messages with callbacks","Extract data from messages","Understand the difference between publishers and subscribers","Comprehend pub/sub decoupling (loose coupling)","Create a system with both publishers and subscribers"],assessment_type:"practical_exercise",keywords:["ROS 2","subscriber","callback","message handler","Pose","turtlesim","decoupling"]},o="Your First Subscriber",c={},a=[{value:"Introduction",id:"introduction",level:2},{value:"Understanding Subscribers: The Theory",id:"understanding-subscribers-the-theory",level:2},{value:"Subscriber Role",id:"subscriber-role",level:3},{value:"Key Difference: Callback Functions",id:"key-difference-callback-functions",level:3},{value:"Layer 2: Creating Your First Subscriber Node",id:"layer-2-creating-your-first-subscriber-node",level:2},{value:"Step 1: Create a File",id:"step-1-create-a-file",level:3},{value:"Step 2: Write the Subscriber Code",id:"step-2-write-the-subscriber-code",level:3},{value:"Step 3: Understand the Code",id:"step-3-understand-the-code",level:3},{value:"Step 4: Run the Subscriber",id:"step-4-run-the-subscriber",level:2},{value:"Step 5: Move the Turtle (to See Data Change)",id:"step-5-move-the-turtle-to-see-data-change",level:2},{value:"\ud83d\udcac AI CoLearning: Understanding Callbacks",id:"-ai-colearning-understanding-callbacks",level:2},{value:"\ud83c\udf93 Expert Insight: Pub/Sub Decoupling",id:"-expert-insight-pubsub-decoupling",level:2},{value:"Before ROS 2 (Direct Coupling)",id:"before-ros-2-direct-coupling",level:3},{value:"With ROS 2 (Loose Coupling)",id:"with-ros-2-loose-coupling",level:3},{value:"Experiment: Modify the Subscriber",id:"experiment-modify-the-subscriber",level:2},{value:"Experiment 1: Detect When Turtle Moves",id:"experiment-1-detect-when-turtle-moves",level:3},{value:"Experiment 2: Calculate Velocity",id:"experiment-2-calculate-velocity",level:3},{value:"Experiment 3: Detect Rotation",id:"experiment-3-detect-rotation",level:3},{value:"Exercise: Pub + Sub Together",id:"exercise-pub--sub-together",level:2},{value:"Task: Create a Feedback Loop",id:"task-create-a-feedback-loop",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Error: &quot;ModuleNotFoundError: No module named &#39;turtlesim&#39;&quot;",id:"error-modulenotfounderror-no-module-named-turtlesim",level:3},{value:"Error: &quot;Callback never fires, no messages&quot;",id:"error-callback-never-fires-no-messages",level:3},{value:"Error: &quot;Invalid message type: Pose&quot;",id:"error-invalid-message-type-pose",level:3},{value:"Self-Assessment",id:"self-assessment",level:2},{value:"What&#39;s Next?",id:"whats-next",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"your-first-subscriber",children:"Your First Subscriber"})}),"\n",(0,i.jsx)(s.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(s.p,{children:["In Lesson 3, you built a ",(0,i.jsx)(s.strong,{children:"publisher"}),"\u2014a node that ",(0,i.jsx)(s.em,{children:"sends"})," messages. Now you'll build a ",(0,i.jsx)(s.strong,{children:"subscriber"}),"\u2014a node that ",(0,i.jsx)(s.em,{children:"receives"})," messages."]}),"\n",(0,i.jsxs)(s.p,{children:["A subscriber doesn't run on a timer (like a publisher often does). Instead, it waits for messages and processes them when they arrive. This is called ",(0,i.jsx)(s.strong,{children:"event-driven programming"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"What you'll build"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"class TurtlePoseReader(Node):\n    # Subscribes to /turtle1/pose\n    # When Turtlesim sends position data, callback function fires\n    # Prints position data to terminal\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"understanding-subscribers-the-theory",children:"Understanding Subscribers: The Theory"}),"\n",(0,i.jsx)(s.h3,{id:"subscriber-role",children:"Subscriber Role"}),"\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.strong,{children:"subscriber"})," is a node that listens to a topic and processes messages when they arrive."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"Turtlesim (Publisher)\n    \u2193 sends position data continuously\n    \u2193\nTopic: /turtle1/pose\n    \u2193 your subscriber listens here\n    \u2193\nYour Code (Subscriber)\n    \u2193 (receives data every ~50 ms)\n    \u2193\nCallback function fires \u2192 Prints position data\n"})}),"\n",(0,i.jsx)(s.h3,{id:"key-difference-callback-functions",children:"Key Difference: Callback Functions"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Publisher"})," uses a timer:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"self.timer = self.create_timer(0.5, self.timer_callback)\n# timer_callback fires every 0.5 seconds (whether or not subscribers exist)\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Subscriber"})," uses a callback:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"self.subscription = self.create_subscription(\n    Pose, '/turtle1/pose', self.listener_callback, 10\n)\n# listener_callback fires ONLY when a message arrives\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This is ",(0,i.jsx)(s.strong,{children:"event-driven"}),": your code waits for events (messages) instead of running on a schedule."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"layer-2-creating-your-first-subscriber-node",children:"Layer 2: Creating Your First Subscriber Node"}),"\n",(0,i.jsx)(s.h3,{id:"step-1-create-a-file",children:"Step 1: Create a File"}),"\n",(0,i.jsxs)(s.p,{children:["Create a new file called ",(0,i.jsx)(s.code,{children:"subscriber_node.py"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"touch ~/subscriber_node.py\n"})}),"\n",(0,i.jsx)(s.h3,{id:"step-2-write-the-subscriber-code",children:"Step 2: Write the Subscriber Code"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Type this code carefully"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'import rclpy\nfrom rclpy.node import Node\nfrom turtlesim.msg import Pose\n\n\nclass TurtlePoseReader(Node):\n    def __init__(self):\n        super().__init__(\'turtle_pose_reader\')\n\n        # Create a subscription to /turtle1/pose\n        # When a message arrives, listener_callback is called\n        self.subscription = self.create_subscription(\n            Pose,                    # Message type\n            \'/turtle1/pose\',         # Topic name\n            self.listener_callback,  # Callback function\n            10                       # Queue size\n        )\n\n        # Prevent unused variable warning\n        self.subscription\n\n        # For tracking\n        self.counter = 0\n\n    def listener_callback(self, msg):\n        """Called whenever a Pose message is received"""\n\n        # Extract position data from the message\n        x = msg.x\n        y = msg.y\n        theta = msg.theta  # Rotation angle\n\n        # Log the position\n        self.get_logger().info(\n            f\'Turtle pose: x={x:.2f}, y={y:.2f}, theta={theta:.2f}\'\n        )\n\n        self.counter += 1\n\n\ndef main(args=None):\n    """Entry point for the ROS 2 node"""\n\n    rclpy.init(args=args)\n    node = TurtlePoseReader()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(s.h3,{id:"step-3-understand-the-code",children:"Step 3: Understand the Code"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Imports"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom turtlesim.msg import Pose  # Message type for turtle position\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Subscription Creation"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"self.subscription = self.create_subscription(\n    Pose,                   # Message type (from turtlesim package)\n    '/turtle1/pose',        # Topic to subscribe to\n    self.listener_callback, # Function to call when message arrives\n    10                      # Queue size\n)\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Callback Function"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"def listener_callback(self, msg):\n    # This function is called EVERY TIME a message arrives\n    x = msg.x        # Extract x coordinate\n    y = msg.y        # Extract y coordinate\n    theta = msg.theta  # Extract rotation\n    self.get_logger().info(...)  # Log it\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Key difference from publisher"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"No timer! The callback fires only when messages arrive"}),"\n",(0,i.jsxs)(s.li,{children:["The callback receives the message as a parameter: ",(0,i.jsx)(s.code,{children:"msg"})]}),"\n",(0,i.jsxs)(s.li,{children:["You extract fields from the message: ",(0,i.jsx)(s.code,{children:"msg.x"}),", ",(0,i.jsx)(s.code,{children:"msg.y"}),", etc."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"step-4-run-the-subscriber",children:"Step 4: Run the Subscriber"}),"\n",(0,i.jsx)(s.p,{children:"Make sure:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Terminal 1"}),": Turtlesim running"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Terminal 2"}),": Your subscriber node"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Terminal 3"})," (optional): Something to move the turtle"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"In Terminal 2:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"python3 ~/subscriber_node.py\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Expected output"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"[INFO] [turtle_pose_reader]: Turtle pose: x=5.54, y=5.54, theta=0.00\n[INFO] [turtle_pose_reader]: Turtle pose: x=5.54, y=5.54, theta=0.00\n[INFO] [turtle_pose_reader]: Turtle pose: x=5.54, y=5.54, theta=0.00\n"})}),"\n",(0,i.jsx)(s.p,{children:"If the values don't change, the turtle isn't moving yet. Let's fix that."}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"step-5-move-the-turtle-to-see-data-change",children:"Step 5: Move the Turtle (to See Data Change)"}),"\n",(0,i.jsxs)(s.p,{children:["Open ",(0,i.jsx)(s.strong,{children:"Terminal 3"})," and run your publisher from Lesson 3:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"python3 ~/publisher_node.py\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"In Terminal 1"})," (Turtlesim window):"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Turtle moves forward"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"In Terminal 2"})," (subscriber output):"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"x values increase! (turtle moving along x-axis)"}),"\n",(0,i.jsxs)(s.li,{children:["Example:","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"[INFO] [turtle_pose_reader]: Turtle pose: x=5.54, y=5.54, theta=0.00\n[INFO] [turtle_pose_reader]: Turtle pose: x=6.03, y=5.54, theta=0.00\n[INFO] [turtle_pose_reader]: Turtle pose: x=6.52, y=5.54, theta=0.00\n[INFO] [turtle_pose_reader]: Turtle pose: x=7.01, y=5.54, theta=0.00\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"This proves"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Your subscriber is receiving messages \u2705"}),"\n",(0,i.jsx)(s.li,{children:"Data is being extracted correctly \u2705"}),"\n",(0,i.jsx)(s.li,{children:"The pub/sub pattern is working \u2705"}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-ai-colearning-understanding-callbacks",children:"\ud83d\udcac AI CoLearning: Understanding Callbacks"}),"\n",(0,i.jsx)(s.p,{children:"The callback pattern is important in ROS 2 (and all event-driven systems)."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Ask Claude"}),":"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:'"Why do we use callbacks instead of polling? Why not check if a message arrived in a while loop?"'}),"\n",(0,i.jsx)(s.li,{children:'"What happens if my callback takes 1 second to process, but messages arrive every 50 ms?"'}),"\n",(0,i.jsx)(s.li,{children:'"Can I have multiple callbacks on the same topic?"'}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Expected answers"}),":"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Callbacks are more efficient\u2014code only runs when something happens"}),"\n",(0,i.jsx)(s.li,{children:"If callback is slow, messages queue up in the queue_size buffer"}),"\n",(0,i.jsx)(s.li,{children:"No, but one node can have multiple subscriptions to different topics"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["This teaches you about ",(0,i.jsx)(s.strong,{children:"event-driven architecture"}),"\u2014the foundation of responsive systems."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"-expert-insight-pubsub-decoupling",children:"\ud83c\udf93 Expert Insight: Pub/Sub Decoupling"}),"\n",(0,i.jsx)(s.p,{children:"Here's the power of the pub/sub pattern:"}),"\n",(0,i.jsx)(s.h3,{id:"before-ros-2-direct-coupling",children:"Before ROS 2 (Direct Coupling)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"# \u274c BAD: Publisher and Subscriber tightly coupled\nclass Publisher:\n    def send_data(self):\n        subscriber.receive(data)  # Direct call!\n\n# Publisher needs to know about Subscriber\n# Tightly coupled, hard to test, hard to reuse\n"})}),"\n",(0,i.jsx)(s.h3,{id:"with-ros-2-loose-coupling",children:"With ROS 2 (Loose Coupling)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"# \u2705 GOOD: Publisher and Subscriber loosely coupled via topic\nclass Publisher(Node):\n    def __init__(self):\n        self.pub = self.create_publisher(Twist, '/cmd_vel', 10)\n\n    def send_data(self):\n        self.pub.publish(data)  # Publish to topic\n\nclass Subscriber(Node):\n    def __init__(self):\n        self.sub = self.create_subscription(Twist, '/cmd_vel', self.callback, 10)\n\n    def callback(self, msg):\n        # Process message\n\n# Publisher doesn't know Subscriber exists\n# Subscriber doesn't know Publisher exists\n# They communicate only through the topic (/cmd_vel)\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Benefits of loose coupling"}),":"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Reusability"}),": Publisher works with ANY subscriber"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Testing"}),": Test publisher and subscriber independently"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Scalability"}),": Add 10 subscribers to same topic\u2014publisher doesn't change"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Flexibility"}),": Replace publisher with different implementation\u2014subscribers don't break"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"This is why ROS 2 is so powerful."}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"experiment-modify-the-subscriber",children:"Experiment: Modify the Subscriber"}),"\n",(0,i.jsx)(s.p,{children:"Now modify the subscriber to do something more interesting."}),"\n",(0,i.jsx)(s.h3,{id:"experiment-1-detect-when-turtle-moves",children:"Experiment 1: Detect When Turtle Moves"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"def listener_callback(self, msg):\n    x = msg.x\n    y = msg.y\n    theta = msg.theta\n\n    # Only log if turtle has moved significantly\n    if self.counter > 0 and (x != self.prev_x or y != self.prev_y):\n        self.get_logger().info(f'Turtle moved! New position: {x:.2f}, {y:.2f}')\n\n    self.prev_x = x\n    self.prev_y = y\n    self.counter += 1\n\n# In __init__:\nself.prev_x = 0.0\nself.prev_y = 0.0\n"})}),"\n",(0,i.jsx)(s.h3,{id:"experiment-2-calculate-velocity",children:"Experiment 2: Calculate Velocity"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"import time\n\ndef listener_callback(self, msg):\n    current_time = time.time()\n\n    if self.counter > 0:\n        dt = current_time - self.prev_time\n        dx = msg.x - self.prev_x\n        dy = msg.y - self.prev_y\n\n        vx = dx / dt  # Velocity in x direction\n        vy = dy / dt  # Velocity in y direction\n\n        self.get_logger().info(f'Velocity: vx={vx:.2f}, vy={vy:.2f}')\n\n    self.prev_x = msg.x\n    self.prev_y = msg.y\n    self.prev_time = current_time\n    self.counter += 1\n\n# In __init__:\nself.prev_x = 0.0\nself.prev_y = 0.0\nself.prev_time = time.time()\n"})}),"\n",(0,i.jsx)(s.h3,{id:"experiment-3-detect-rotation",children:"Experiment 3: Detect Rotation"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"def listener_callback(self, msg):\n    theta = msg.theta\n\n    # Is the turtle rotating?\n    if abs(msg.angular_velocity) > 0.1:  # Rotating faster than 0.1 rad/s\n        self.get_logger().info(f'Turtle is rotating! Angle: {theta:.2f}')\n    else:\n        self.get_logger().info(f'Turtle is stationary. Angle: {theta:.2f}')\n\n    self.counter += 1\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"exercise-pub--sub-together",children:"Exercise: Pub + Sub Together"}),"\n",(0,i.jsx)(s.p,{children:"Now you understand both publishers and subscribers. Let's combine them:"}),"\n",(0,i.jsx)(s.h3,{id:"task-create-a-feedback-loop",children:"Task: Create a Feedback Loop"}),"\n",(0,i.jsx)(s.p,{children:"Build a system where:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Publisher"}),' sends "move forward" command every 0.5 seconds']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Subscriber"})," reads turtle position every ~50 ms"]}),"\n",(0,i.jsxs)(s.li,{children:["When turtle has moved 1 meter, ",(0,i.jsx)(s.strong,{children:"stop"})]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Here's a skeleton:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom turtlesim.msg import Pose\n\n\nclass TurtleController(Node):\n    def __init__(self):\n        super().__init__('turtle_controller')\n\n        # Publisher (sends commands)\n        self.publisher_ = self.create_publisher(Twist, '/turtle1/cmd_vel', 10)\n\n        # Subscriber (reads position)\n        self.subscription = self.create_subscription(\n            Pose, '/turtle1/pose', self.pose_callback, 10\n        )\n\n        # Timer (sends commands periodically)\n        self.timer = self.create_timer(0.5, self.timer_callback)\n\n        # Track starting position\n        self.start_x = None\n        self.distance_traveled = 0.0\n\n    def pose_callback(self, msg):\n        # Called when position data arrives\n        if self.start_x is None:\n            self.start_x = msg.x  # Record starting position\n\n        # Calculate distance traveled\n        self.distance_traveled = msg.x - self.start_x\n        self.get_logger().info(f'Distance: {self.distance_traveled:.2f} meters')\n\n        # Stop if we've moved 1 meter\n        if self.distance_traveled >= 1.0:\n            self.get_logger().info('Reached goal! Stopping.')\n            rclpy.shutdown()\n\n    def timer_callback(self):\n        # Called every 0.5 seconds\n        msg = Twist()\n        msg.linear.x = 1.0  # Move forward\n        self.publisher_.publish(msg)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TurtleController()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Run it"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"python3 turtle_controller.py\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Expected behavior"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Turtle starts moving forward"}),"\n",(0,i.jsx)(s.li,{children:"Node logs distance traveled"}),"\n",(0,i.jsx)(s.li,{children:"When distance reaches 1.0 meter, turtle stops"}),"\n",(0,i.jsx)(s.li,{children:"Node shuts down"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"What this demonstrates"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Publisher sends commands (control)"}),"\n",(0,i.jsx)(s.li,{children:"Subscriber receives feedback (sensing)"}),"\n",(0,i.jsx)(s.li,{children:"Node makes decisions based on feedback"}),"\n",(0,i.jsxs)(s.li,{children:["This is the foundation of ",(0,i.jsx)(s.strong,{children:"closed-loop control"})]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(s.h3,{id:"error-modulenotfounderror-no-module-named-turtlesim",children:"Error: \"ModuleNotFoundError: No module named 'turtlesim'\""}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Cause"}),": turtlesim not installed or not in Python path"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo apt install ros-humble-turtlesim\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"error-callback-never-fires-no-messages",children:'Error: "Callback never fires, no messages"'}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Diagnosis steps"}),":"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Is Turtlesim running?"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ros2 node list | grep turtlesim\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Is the topic being published?"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ros2 topic echo /turtle1/pose\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Is your subscriber listening to the right topic?"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ros2 node info /turtle_pose_reader\n"})}),"\n",(0,i.jsx)(s.p,{children:'Check the "Subscribers" section.'}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"If all checks pass, the callback should fire. If not, check:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Topic name spelling (case-sensitive!)"}),"\n",(0,i.jsx)(s.li,{children:"Message type matches (Pose from turtlesim)"}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"error-invalid-message-type-pose",children:'Error: "Invalid message type: Pose"'}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Cause"}),": Import statement wrong"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"from turtlesim.msg import Pose  # Correct\n# NOT:\nfrom std_msgs.msg import Pose  # Wrong\n"})}),"\n",(0,i.jsx)(s.p,{children:"Pose is specific to turtlesim. Check the import!"}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"self-assessment",children:"Self-Assessment"}),"\n",(0,i.jsx)(s.p,{children:"Before moving to Lesson 6, verify:"}),"\n",(0,i.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Created ",(0,i.jsx)(s.code,{children:"subscriber_node.py"})," with working code"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Node subscribes to ",(0,i.jsx)(s.code,{children:"/turtle1/pose"})]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Callback fires when messages arrive"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Can extract x, y, theta from Pose message"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Sees different values when turtle moves"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Debugged issues using ",(0,i.jsx)(s.code,{children:"ros2 node info"})," and ",(0,i.jsx)(s.code,{children:"ros2 topic echo"})]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Understood the callback pattern (event-driven vs timer-based)"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Understood pub/sub decoupling (loose coupling)"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Created a feedback loop with both pub and sub"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["If all checkboxes pass, ",(0,i.jsx)(s.strong,{children:"you're ready for Lesson 6: Multi-Node Systems"}),"."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,i.jsx)(s.p,{children:"Lesson 6 brings it all together. You'll:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Create ",(0,i.jsx)(s.strong,{children:"3+ nodes"})," that work together"]}),"\n",(0,i.jsx)(s.li,{children:"Demonstrate how independent processes coordinate via topics"}),"\n",(0,i.jsx)(s.li,{children:"Build a complete robot system (sensor \u2192 decision \u2192 action)"}),"\n",(0,i.jsx)(s.li,{children:"Work with AI to design system architecture"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["This is your ",(0,i.jsx)(s.strong,{children:"capstone for Chapter 1"}),"."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.a,{href:"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/multi-node-systems",children:"\u2192 Lesson 6: Building Multi-Node Systems"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"ROS 2 Simple Subscriber Tutorial"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://docs.ros2.org/latest/api/turtlesim/msg/Pose.html",children:"Turtlesim Pose Message"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://docs.ros2.org/latest/api/rclpy/api/node.html#rclpy.node.Node.create_subscription",children:"rclpy Subscriptions"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Event-driven_programming",children:"Event-Driven Programming"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8439:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>o});var r=n(758);const i={},t=r.createContext(i);function l(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);