"use strict";(self.webpackChunkphysical_ai_robotics_textbook=self.webpackChunkphysical_ai_robotics_textbook||[]).push([[3009],{3066:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"chapter-1-ros2-fundamentals/subscriber","title":"Your First ROS 2 Subscriber","description":"Introduction","source":"@site/docs/01-chapter-1-ros2-fundamentals/05-subscriber.md","sourceDirName":"01-chapter-1-ros2-fundamentals","slug":"/chapter-1-ros2-fundamentals/subscriber","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/subscriber","draft":false,"unlisted":false,"editUrl":"https://github.com/devhammad0/physical-ai-robotics-textbook/tree/main/docs/01-chapter-1-ros2-fundamentals/05-subscriber.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Your First ROS 2 Subscriber","chapter":1,"lesson":5,"duration_minutes":60,"simulation_required":["turtlesim"],"safety_level":"simulation_only","cefr_level":"B1","hardware_prerequisites":[],"learning_objectives":["Create a ROS 2 subscriber node using rclpy","Implement message callbacks to react to incoming data","Extract data from ROS 2 message objects","Synchronize data between multiple nodes","Debug subscription issues using CLI tools","Combine publishers and subscribers into complete systems","Handle message timing and asynchronous execution"],"primary_layer":"Layer 1 (Manual Foundation) + Layer 2 (AI Collaboration)"},"sidebar":"tutorialSidebar","previous":{"title":"Your First ROS 2 Publisher","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/publisher"},"next":{"title":"Services and Actions: Synchronous & Long-Running Communication","permalink":"/physical-ai-robotics-textbook/docs/chapter-1-ros2-fundamentals/services-actions"}}');var t=n(6070),i=n(8439);const l={title:"Your First ROS 2 Subscriber",chapter:1,lesson:5,duration_minutes:60,simulation_required:["turtlesim"],safety_level:"simulation_only",cefr_level:"B1",hardware_prerequisites:[],learning_objectives:["Create a ROS 2 subscriber node using rclpy","Implement message callbacks to react to incoming data","Extract data from ROS 2 message objects","Synchronize data between multiple nodes","Debug subscription issues using CLI tools","Combine publishers and subscribers into complete systems","Handle message timing and asynchronous execution"],primary_layer:"Layer 1 (Manual Foundation) + Layer 2 (AI Collaboration)"},a=void 0,o={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Foundational Knowledge Review",id:"foundational-knowledge-review",level:2},{value:"Subscription API",id:"subscription-api",level:3},{value:"Message Types (Turtlesim)",id:"message-types-turtlesim",level:3},{value:"Concept 1: Asynchronous Callbacks",id:"concept-1-asynchronous-callbacks",level:2},{value:"Callback Pattern",id:"callback-pattern",level:3},{value:"Key Points",id:"key-points",level:3},{value:"Common Pitfall",id:"common-pitfall",level:3},{value:"Concept 2: Message Data Extraction",id:"concept-2-message-data-extraction",level:2},{value:"Nested Fields",id:"nested-fields",level:3},{value:"Introspection",id:"introspection",level:3},{value:"Concept 3: State Management in Subscribers",id:"concept-3-state-management-in-subscribers",level:2},{value:"Using Instance Variables",id:"using-instance-variables",level:3},{value:"Code Example 1: Simple Subscriber",id:"code-example-1-simple-subscriber",level:2},{value:"How to Run",id:"how-to-run",level:3},{value:"Expected Output",id:"expected-output",level:3},{value:"Code Example 2: Subscriber with State Management",id:"code-example-2-subscriber-with-state-management",level:2},{value:"Running the Tracking Example",id:"running-the-tracking-example",level:3},{value:"Expected Output",id:"expected-output-1",level:3},{value:"Code Example 3: Combined Publisher + Subscriber",id:"code-example-3-combined-publisher--subscriber",level:2},{value:"Running the Combined Example",id:"running-the-combined-example",level:3},{value:"Expected Output",id:"expected-output-2",level:3},{value:"Debugging Subscribers",id:"debugging-subscribers",level:2},{value:"Problem: &quot;No messages received&quot;",id:"problem-no-messages-received",level:3},{value:"Problem: &quot;Messages received but outdated&quot;",id:"problem-messages-received-but-outdated",level:3},{value:"Problem: &quot;Callback too slow&quot;",id:"problem-callback-too-slow",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Error: &quot;ModuleNotFoundError: No module named &#39;turtlesim&#39;&quot;",id:"error-modulenotfounderror-no-module-named-turtlesim",level:3},{value:"Error: &quot;Could not import ROS 2 Python library&quot;",id:"error-could-not-import-ros-2-python-library",level:3},{value:"Error: &quot;Subscription callback raises AttributeError&quot;",id:"error-subscription-callback-raises-attributeerror",level:3},{value:"Error: &quot;Callback not being called&quot;",id:"error-callback-not-being-called",level:3},{value:"Error: &quot;Topic name &#39;/turtle1/pose&#39; not found&quot;",id:"error-topic-name-turtle1pose-not-found",level:3},{value:"Layer 2: AI Collaboration Prompts",id:"layer-2-ai-collaboration-prompts",level:2},{value:"Prompt 1: Understanding Callbacks",id:"prompt-1-understanding-callbacks",level:3},{value:"Prompt 2: Message Queuing",id:"prompt-2-message-queuing",level:3},{value:"Prompt 3: Synchronization",id:"prompt-3-synchronization",level:3},{value:"Self-Assessment Checklist",id:"self-assessment-checklist",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const r={code:"code",h2:"h2",h3:"h3",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(r.p,{children:["In Lesson 4, you created a publisher that ",(0,t.jsx)(r.strong,{children:"sends"})," messages. Now it's time to create a subscriber that ",(0,t.jsx)(r.strong,{children:"receives"})," messages."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"What you'll build"}),": A subscriber node that:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Subscribes to the ",(0,t.jsx)(r.code,{children:"/turtle1/pose"})," topic (turtle's current position)"]}),"\n",(0,t.jsx)(r.li,{children:"Receives messages whenever the turtle moves"}),"\n",(0,t.jsx)(r.li,{children:"Logs position data (x, y, heading) to the console"}),"\n",(0,t.jsx)(r.li,{children:"Calculates distance traveled and speed"}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Simulation environment"}),": Turtlesim (from Lesson 2)"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Time estimate"}),": 60 minutes (including running and debugging)"]}),"\n",(0,t.jsx)(r.p,{children:"By the end, you'll understand:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"How subscription callbacks work"}),"\n",(0,t.jsx)(r.li,{children:"How to extract data from message objects"}),"\n",(0,t.jsx)(r.li,{children:"How to handle asynchronous message delivery"}),"\n",(0,t.jsx)(r.li,{children:"How to create complete pub/sub systems (publisher + subscriber)"}),"\n",(0,t.jsx)(r.li,{children:"How to debug timing issues"}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"foundational-knowledge-review",children:"Foundational Knowledge Review"}),"\n",(0,t.jsx)(r.h3,{id:"subscription-api",children:"Subscription API"}),"\n",(0,t.jsx)(r.p,{children:"A subscriber is created in the node constructor:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"self.subscription = self.create_subscription(\r\n    msg_type,              # e.g., turtlesim.msg.Pose\r\n    topic_name,            # e.g., '/turtle1/pose'\r\n    callback_function,     # Called when message arrives\r\n    queue_size             # e.g., 10 (max queued messages)\r\n)\n"})}),"\n",(0,t.jsx)(r.p,{children:"The callback is invoked asynchronously:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'def subscription_callback(self, msg):\r\n    # Called whenever a message arrives on the topic\r\n    self.get_logger().info(f"Received: x={msg.x}, y={msg.y}")\n'})}),"\n",(0,t.jsx)(r.h3,{id:"message-types-turtlesim",children:"Message Types (Turtlesim)"}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"/turtle1/pose"})," topic publishes ",(0,t.jsx)(r.code,{children:"turtlesim.msg.Pose"})," messages:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"turtlesim.msg.Pose:\r\n  x: float              # Position x (0 to 11.08)\r\n  y: float              # Position y (0 to 11.08)\r\n  theta: float          # Heading angle in radians\r\n  linear_velocity: float # Current linear speed (m/s)\r\n  angular_velocity: float # Current angular speed (rad/s)\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"concept-1-asynchronous-callbacks",children:"Concept 1: Asynchronous Callbacks"}),"\n",(0,t.jsxs)(r.p,{children:["Unlike imperative code that runs line-by-line, ROS 2 subscribers use ",(0,t.jsx)(r.strong,{children:"event-driven programming"}),". Your callback is invoked automatically when data arrives."]}),"\n",(0,t.jsx)(r.h3,{id:"callback-pattern",children:"Callback Pattern"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'def pose_callback(self, msg):\r\n    # This runs automatically when a message arrives\r\n    # msg contains the data from the publisher\r\n    x = msg.x\r\n    y = msg.y\r\n    self.get_logger().info(f"Turtle at ({x:.2f}, {y:.2f})")\n'})}),"\n",(0,t.jsx)(r.h3,{id:"key-points",children:"Key Points"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Non-blocking"}),": Your callback doesn't block other nodes"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Automatic invocation"}),": ROS 2 calls your function automatically"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Single-threaded by default"}),": Callbacks run sequentially (not in parallel)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Fast execution"}),": Keep callbacks quick (< 100 ms) to avoid losing messages"]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"common-pitfall",children:"Common Pitfall"}),"\n",(0,t.jsx)(r.p,{children:"Beginners sometimes write:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# WRONG: This doesn't work!\r\ndef wrong_way(self):\r\n    msg = self.get_latest_message()  # No such method!\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Instead, ",(0,t.jsx)(r.strong,{children:"always"})," use callbacks:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# RIGHT: Use callbacks\r\ndef subscription_callback(self, msg):\r\n    # msg is automatically passed when data arrives\r\n    self.process(msg)\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"concept-2-message-data-extraction",children:"Concept 2: Message Data Extraction"}),"\n",(0,t.jsx)(r.p,{children:"ROS 2 messages are Python objects with fields. Access fields using dot notation:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'def callback(self, msg):\r\n    x = msg.x              # Field access\r\n    y = msg.y\r\n    theta = msg.theta\r\n\r\n    # Calculate distance from origin\r\n    distance = (x**2 + y**2) ** 0.5\r\n    self.get_logger().info(f"Distance from origin: {distance:.2f}")\n'})}),"\n",(0,t.jsx)(r.h3,{id:"nested-fields",children:"Nested Fields"}),"\n",(0,t.jsx)(r.p,{children:"Some messages have nested objects:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# geometry_msgs.msg.Twist (has nested Vector3 objects)\r\nmsg.linear.x    # Linear velocity in x direction\r\nmsg.angular.z   # Angular velocity (yaw rotation)\n"})}),"\n",(0,t.jsx)(r.h3,{id:"introspection",children:"Introspection"}),"\n",(0,t.jsx)(r.p,{children:"To see all fields in a message, use the CLI:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ros2 interface show turtlesim/msg/Pose\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"concept-3-state-management-in-subscribers",children:"Concept 3: State Management in Subscribers"}),"\n",(0,t.jsx)(r.p,{children:"Subscribers often need to remember previous data (e.g., to calculate distance traveled or velocity)."}),"\n",(0,t.jsx)(r.h3,{id:"using-instance-variables",children:"Using Instance Variables"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"class TurtleSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('turtle_subscriber')\r\n\r\n        # Store previous position\r\n        self.prev_x = 0.0\r\n        self.prev_y = 0.0\r\n        self.total_distance = 0.0\r\n\r\n        # Create subscription\r\n        self.subscription = self.create_subscription(\r\n            Pose, '/turtle1/pose', self.pose_callback, 10)\r\n\r\n    def pose_callback(self, msg):\r\n        # Calculate distance traveled since last message\r\n        dx = msg.x - self.prev_x\r\n        dy = msg.y - self.prev_y\r\n        distance = (dx**2 + dy**2) ** 0.5\r\n\r\n        self.total_distance += distance\r\n\r\n        # Update previous position\r\n        self.prev_x = msg.x\r\n        self.prev_y = msg.y\r\n\r\n        self.get_logger().info(\r\n            f\"Distance traveled: {distance:.3f}, Total: {self.total_distance:.3f}\")\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"code-example-1-simple-subscriber",children:"Code Example 1: Simple Subscriber"}),"\n",(0,t.jsxs)(r.p,{children:["Create a file: ",(0,t.jsx)(r.code,{children:"subscriber_node.py"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'"""\r\nSimple ROS 2 Subscriber Node\r\nSimulation environment: Turtlesim\r\nSubscribes to turtle position and logs it\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom turtlesim.msg import Pose\r\n\r\n\r\nclass TurtleSubscriber(Node):\r\n    """Simple subscriber that listens to turtle position"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'turtle_subscriber\')\r\n\r\n        # Create subscription to turtle pose topic\r\n        self.subscription = self.create_subscription(\r\n            Pose,                      # Message type\r\n            \'/turtle1/pose\',           # Topic name\r\n            self.pose_callback,        # Callback function\r\n            10                         # Queue size\r\n        )\r\n\r\n        self.get_logger().info(\'Turtle subscriber started\')\r\n\r\n    def pose_callback(self, msg):\r\n        """Called whenever a pose message arrives"""\r\n        # Extract position and heading\r\n        x = msg.x\r\n        y = msg.y\r\n        theta = msg.theta\r\n\r\n        # Log the data\r\n        self.get_logger().info(\r\n            f\'Turtle position: x={x:.2f}, y={y:.2f}, heading={theta:.2f} rad\')\r\n\r\n\r\ndef main(args=None):\r\n    """Entry point for the node"""\r\n    rclpy.init(args=args)\r\n\r\n    node = TurtleSubscriber()\r\n\r\n    try:\r\n        # Spin: keep the node running and process callbacks\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        # Cleanup\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsx)(r.h3,{id:"how-to-run",children:"How to Run"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Terminal 1"}),": Start Turtlesim simulator"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ros2 run turtlesim turtlesim_node\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Terminal 2"}),": Start the subscriber"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"cd ~/ros2_workspace/src/my_first_package\r\npython3 subscriber_node.py\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Terminal 3"}),": Publish commands to move the turtle"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ros2 topic pub /turtle1/cmd_vel geometry_msgs/Twist \\\r\n  '{linear: {x: 1.0}, angular: {z: 0.5}}'\n"})}),"\n",(0,t.jsx)(r.h3,{id:"expected-output",children:"Expected Output"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"[INFO] [turtle_subscriber]: Turtle subscriber started\r\n[INFO] [turtle_subscriber]: Turtle position: x=5.54, y=5.54, heading=0.00 rad\r\n[INFO] [turtle_subscriber]: Turtle position: x=5.55, y=5.54, heading=0.05 rad\r\n[INFO] [turtle_subscriber]: Turtle position: x=5.57, y=5.54, heading=0.10 rad\r\n[INFO] [turtle_subscriber]: Turtle position: x=5.60, y=5.54, heading=0.15 rad\n"})}),"\n",(0,t.jsx)(r.p,{children:"The subscriber logs the turtle's position continuously as it moves."}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"code-example-2-subscriber-with-state-management",children:"Code Example 2: Subscriber with State Management"}),"\n",(0,t.jsx)(r.p,{children:"This example calculates distance traveled and average speed."}),"\n",(0,t.jsxs)(r.p,{children:["Create: ",(0,t.jsx)(r.code,{children:"tracking_subscriber.py"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'"""\r\nTracking Subscriber: Calculates distance and speed\r\nSimulation environment: Turtlesim\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom turtlesim.msg import Pose\r\n\r\n\r\nclass TrackingSubscriber(Node):\r\n    """Subscriber that tracks position changes"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'tracking_subscriber\')\r\n\r\n        # State variables\r\n        self.prev_x = 0.0\r\n        self.prev_y = 0.0\r\n        self.total_distance = 0.0\r\n        self.message_count = 0\r\n\r\n        # Create subscription\r\n        self.subscription = self.create_subscription(\r\n            Pose,\r\n            \'/turtle1/pose\',\r\n            self.pose_callback,\r\n            10\r\n        )\r\n\r\n        self.get_logger().info(\'Tracking subscriber started\')\r\n\r\n    def pose_callback(self, msg):\r\n        """Track position changes and calculate distance"""\r\n\r\n        # Get current position\r\n        curr_x = msg.x\r\n        curr_y = msg.y\r\n\r\n        # Calculate distance from last position\r\n        dx = curr_x - self.prev_x\r\n        dy = curr_y - self.prev_y\r\n        distance = (dx**2 + dy**2) ** 0.5\r\n\r\n        # Update total\r\n        self.total_distance += distance\r\n        self.message_count += 1\r\n\r\n        # Update previous position\r\n        self.prev_x = curr_x\r\n        self.prev_y = curr_y\r\n\r\n        # Log with calculated statistics\r\n        self.get_logger().info(\r\n            f\'Position: ({curr_x:.2f}, {curr_y:.2f}) | \'\r\n            f\'Distance this step: {distance:.4f} | \'\r\n            f\'Total distance: {self.total_distance:.2f}\')\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TrackingSubscriber()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsx)(r.h3,{id:"running-the-tracking-example",children:"Running the Tracking Example"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Terminal 1: Turtlesim\r\nros2 run turtlesim turtlesim_node\r\n\r\n# Terminal 2: Tracking subscriber\r\npython3 tracking_subscriber.py\r\n\r\n# Terminal 3: Command the turtle to move in a square\r\nros2 topic pub -r 10 /turtle1/cmd_vel geometry_msgs/Twist \\\r\n  '{linear: {x: 1.0}, angular: {z: 0.5}}'\n"})}),"\n",(0,t.jsx)(r.h3,{id:"expected-output-1",children:"Expected Output"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"[INFO] [tracking_subscriber]: Tracking subscriber started\r\n[INFO] [tracking_subscriber]: Position: (5.55, 5.55) | Distance this step: 0.0141 | Total distance: 0.0141\r\n[INFO] [tracking_subscriber]: Position: (5.60, 5.56) | Distance this step: 0.0500 | Total distance: 0.0641\r\n[INFO] [tracking_subscriber]: Position: (5.65, 5.58) | Distance this step: 0.0707 | Total distance: 0.1348\r\n[INFO] [tracking_subscriber]: Position: (5.72, 5.62) | Distance this step: 0.0943 | Total distance: 0.2291\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"code-example-3-combined-publisher--subscriber",children:"Code Example 3: Combined Publisher + Subscriber"}),"\n",(0,t.jsx)(r.p,{children:"Let's create a node that both publishes and subscribes (common in real systems)."}),"\n",(0,t.jsxs)(r.p,{children:["Create: ",(0,t.jsx)(r.code,{children:"publisher_subscriber.py"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'"""\r\nCombined Publisher and Subscriber\r\nPublishes velocity commands AND subscribes to position\r\nSimulation environment: Turtlesim\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nfrom turtlesim.msg import Pose\r\nimport math\r\n\r\n\r\nclass TurtleController(Node):\r\n    """Node that controls turtle and monitors position"""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'turtle_controller\')\r\n\r\n        # Publisher for commands\r\n        self.publisher = self.create_publisher(\r\n            Twist, \'/turtle1/cmd_vel\', 10)\r\n\r\n        # Subscriber for position\r\n        self.subscription = self.create_subscription(\r\n            Pose, \'/turtle1/pose\', self.pose_callback, 10)\r\n\r\n        # State: track target vs actual\r\n        self.target_x = 9.0\r\n        self.target_y = 9.0\r\n        self.current_x = 5.54\r\n        self.current_y = 5.54\r\n        self.current_theta = 0.0\r\n\r\n        # Timer to publish commands periodically\r\n        self.timer = self.create_timer(0.1, self.control_loop)\r\n\r\n        self.get_logger().info(\'Turtle controller started\')\r\n        self.get_logger().info(f\'Target: ({self.target_x}, {self.target_y})\')\r\n\r\n    def pose_callback(self, msg):\r\n        """Update current position"""\r\n        self.current_x = msg.x\r\n        self.current_y = msg.y\r\n        self.current_theta = msg.theta\r\n\r\n    def control_loop(self):\r\n        """Simple control: move towards target"""\r\n\r\n        # Calculate direction to target\r\n        dx = self.target_x - self.current_x\r\n        dy = self.target_y - self.current_y\r\n        distance_to_target = math.sqrt(dx**2 + dy**2)\r\n\r\n        if distance_to_target < 0.2:\r\n            # Reached target\r\n            msg = Twist()\r\n            msg.linear.x = 0.0\r\n            msg.angular.z = 0.0\r\n            self.get_logger().info(\'Target reached!\')\r\n        else:\r\n            # Move towards target\r\n            angle_to_target = math.atan2(dy, dx)\r\n            angle_error = angle_to_target - self.current_theta\r\n\r\n            # Normalize angle error to [-pi, pi]\r\n            while angle_error > math.pi:\r\n                angle_error -= 2 * math.pi\r\n            while angle_error < -math.pi:\r\n                angle_error += 2 * math.pi\r\n\r\n            # Create command\r\n            msg = Twist()\r\n            msg.linear.x = min(1.0, distance_to_target)  # Move forward\r\n            msg.angular.z = angle_error  # Turn towards target\r\n\r\n        self.publisher.publish(msg)\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TurtleController()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        # Stop the turtle\r\n        msg = Twist()\r\n        node.publisher.publish(msg)\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsx)(r.h3,{id:"running-the-combined-example",children:"Running the Combined Example"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Terminal 1: Turtlesim\r\nros2 run turtlesim turtlesim_node\r\n\r\n# Terminal 2: Controller (moves turtle to position 9,9)\r\npython3 publisher_subscriber.py\n"})}),"\n",(0,t.jsx)(r.h3,{id:"expected-output-2",children:"Expected Output"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"[INFO] [turtle_controller]: Turtle controller started\r\n[INFO] [turtle_controller]: Target: (9.0, 9.0)\r\n[INFO] [turtle_controller]: Turtle moving towards target...\r\n[INFO] [turtle_controller]: Target reached!\n"})}),"\n",(0,t.jsx)(r.p,{children:"The turtle will move from its starting position to (9.0, 9.0)."}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"debugging-subscribers",children:"Debugging Subscribers"}),"\n",(0,t.jsx)(r.h3,{id:"problem-no-messages-received",children:'Problem: "No messages received"'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Symptom"}),": Callback never fires, no error messages"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Diagnosis"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check topic exists and has publishers\r\nros2 topic list\r\nros2 topic info /turtle1/pose\r\n\r\n# Check if publisher is sending\r\nros2 topic echo /turtle1/pose\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution"}),": Ensure publisher is running before subscriber:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Terminal 1: Publisher sends data\r\npython3 publisher_node.py\r\n\r\n# Terminal 2: Subscriber receives it\r\npython3 subscriber_node.py\n"})}),"\n",(0,t.jsx)(r.h3,{id:"problem-messages-received-but-outdated",children:'Problem: "Messages received but outdated"'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Symptom"}),": Callback processes very old data"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Queue is full, old messages are dropped"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution"}),": Increase queue size"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# Default: queue_size=10\r\nself.subscription = self.create_subscription(\r\n    Pose, '/turtle1/pose', self.callback, 100)  # Bigger queue\n"})}),"\n",(0,t.jsx)(r.h3,{id:"problem-callback-too-slow",children:'Problem: "Callback too slow"'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Symptom"}),": Console logs don't keep up with message rate"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Callback takes too long to execute"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution"}),": Keep callbacks fast"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# BAD: Slow callback\r\ndef slow_callback(self, msg):\r\n    time.sleep(1)  # Too slow!\r\n    self.process(msg)\r\n\r\n# GOOD: Fast callback\r\ndef fast_callback(self, msg):\r\n    self.queue.put(msg)  # Just queue it, process later\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(r.h3,{id:"error-modulenotfounderror-no-module-named-turtlesim",children:"Error: \"ModuleNotFoundError: No module named 'turtlesim'\""}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": turtlesim not installed"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo apt update\r\nsudo apt install ros-humble-turtlesim\n"})}),"\n",(0,t.jsx)(r.h3,{id:"error-could-not-import-ros-2-python-library",children:'Error: "Could not import ROS 2 Python library"'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": ROS 2 environment not sourced"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash\r\npython3 subscriber_node.py\n"})}),"\n",(0,t.jsx)(r.h3,{id:"error-subscription-callback-raises-attributeerror",children:'Error: "Subscription callback raises AttributeError"'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Accessing wrong field on message"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Example"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# WRONG: Pose doesn't have 'velocity'\r\ndef callback(self, msg):\r\n    v = msg.velocity  # AttributeError!\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution"}),": Use correct field name"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"# RIGHT: Use correct fields\r\ndef callback(self, msg):\r\n    x = msg.x\r\n    y = msg.y\r\n    vx = msg.linear_velocity\n"})}),"\n",(0,t.jsx)(r.p,{children:"Check message structure:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ros2 interface show turtlesim/msg/Pose\n"})}),"\n",(0,t.jsx)(r.h3,{id:"error-callback-not-being-called",children:'Error: "Callback not being called"'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": ",(0,t.jsx)(r.code,{children:"rclpy.spin()"})," not called"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Check"}),": Ensure main function has:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"def main(args=None):\r\n    rclpy.init(args=args)\r\n    node = MySubscriber()\r\n    rclpy.spin(node)  # REQUIRED!\r\n    rclpy.shutdown()\n"})}),"\n",(0,t.jsx)(r.h3,{id:"error-topic-name-turtle1pose-not-found",children:"Error: \"Topic name '/turtle1/pose' not found\""}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cause"}),": Publisher not running or using different topic name"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# List all active topics\r\nros2 topic list\r\n\r\n# Check which topics have publishers\r\nros2 topic info <topic_name>\r\n\r\n# Monitor what's being published\r\nros2 topic echo /turtle1/pose\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"layer-2-ai-collaboration-prompts",children:"Layer 2: AI Collaboration Prompts"}),"\n",(0,t.jsx)(r.h3,{id:"prompt-1-understanding-callbacks",children:"Prompt 1: Understanding Callbacks"}),"\n",(0,t.jsx)(r.p,{children:"\"I just learned about ROS 2 callbacks. Ask Claude: 'Why are callbacks better than polling (constantly checking) for new messages in robotics applications?'\""}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"What you're exploring"}),": Event-driven vs. polling architectures"]}),"\n",(0,t.jsx)(r.h3,{id:"prompt-2-message-queuing",children:"Prompt 2: Message Queuing"}),"\n",(0,t.jsx)(r.p,{children:"\"Ask Claude: 'What happens in ROS 2 when a subscriber's queue is full? How does it decide which messages to drop?'\""}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"What you're exploring"}),": Quality-of-Service (QoS) policies"]}),"\n",(0,t.jsx)(r.h3,{id:"prompt-3-synchronization",children:"Prompt 3: Synchronization"}),"\n",(0,t.jsx)(r.p,{children:"\"Ask Claude: 'If I have a publisher running at 10 Hz and a subscriber queue size of 1, how many messages will be lost?'\""}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"What you're exploring"}),": Timing and synchronization in distributed systems"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"self-assessment-checklist",children:"Self-Assessment Checklist"}),"\n",(0,t.jsx)(r.p,{children:"After completing this lesson, verify:"}),"\n",(0,t.jsxs)(r.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I understand what a subscription callback is"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can create a subscriber node from scratch"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can extract fields from ROS 2 message objects"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I understand how to manage state in subscribers"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can track changes between messages"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can combine publishers and subscribers"]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I can debug subscriber issues using ",(0,t.jsx)(r.code,{children:"ros2 topic"})]}),"\n",(0,t.jsxs)(r.li,{className:"task-list-item",children:[(0,t.jsx)(r.input,{type:"checkbox",disabled:!0})," ","I know when to use queues vs. keeping fresh data"]}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Ready for Lesson 6?"})," In the next lesson, you'll learn about ",(0,t.jsx)(r.strong,{children:"Services and Actions"}),"\u2014synchronous request-response communication patterns that are essential for ROS 2 robotics systems."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Optional Challenge"}),": Modify ",(0,t.jsx)(r.code,{children:"tracking_subscriber.py"})," to:"]}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Calculate average velocity (distance / time)"}),"\n",(0,t.jsx)(r.li,{children:"Detect when the turtle stops (velocity near zero)"}),"\n",(0,t.jsx)(r.li,{children:"Log a message when the turtle has been stationary for 2 seconds"}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"End of Lesson 5: Your First ROS 2 Subscriber"})})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8439:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>a});var s=n(758);const t={},i=s.createContext(t);function l(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);