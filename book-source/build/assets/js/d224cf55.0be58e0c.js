"use strict";(self.webpackChunkphysical_ai_robotics_textbook=self.webpackChunkphysical_ai_robotics_textbook||[]).push([[5790],{4388:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"chapter-3-autonomous-navigation/nav2-path-planning-stack","title":"Lesson 4: Nav2 Path Planning Stack","description":"Duration Unlimited | Priority Lesson 1","source":"@site/docs/03-chapter-3-autonomous-navigation/04-nav2-path-planning-stack.md","sourceDirName":"03-chapter-3-autonomous-navigation","slug":"/chapter-3-autonomous-navigation/nav2-path-planning-stack","permalink":"/physical-ai-robotics-textbook/docs/chapter-3-autonomous-navigation/nav2-path-planning-stack","draft":false,"unlisted":false,"editUrl":"https://github.com/devhammad0/physical-ai-robotics-textbook/tree/main/docs/03-chapter-3-autonomous-navigation/04-nav2-path-planning-stack.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Lesson 3: Introduction to Isaac Sim","permalink":"/physical-ai-robotics-textbook/docs/chapter-3-autonomous-navigation/introduction-to-isaac-sim"},"next":{"title":"Lesson 5: Obstacle Avoidance and Dynamic Environments","permalink":"/physical-ai-robotics-textbook/docs/chapter-3-autonomous-navigation/obstacle-avoidance-and-dynamic-environments"}}');var r=a(6070),s=a(8439);const t={},l="Lesson 4: Nav2 Path Planning Stack",o={},c=[{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Layer 1: Foundation",id:"layer-1-foundation",level:2},{value:"4.1 Navigation Pipeline Overview",id:"41-navigation-pipeline-overview",level:3},{value:"4.2 The Nav2 Stack",id:"42-the-nav2-stack",level:3},{value:"4.3 Costmap Representation",id:"43-costmap-representation",level:3},{value:"4.4 Global Planning Algorithms",id:"44-global-planning-algorithms",level:3},{value:"RRT (Rapidly-Exploring Random Tree)",id:"rrt-rapidly-exploring-random-tree",level:4},{value:"RRT* (RRT-Star)",id:"rrt-rrt-star",level:4},{value:"Theta* (Theta-Star)",id:"theta-theta-star",level:4},{value:"4.5 Local Planning: Dynamic Window Approach (DWA)",id:"45-local-planning-dynamic-window-approach-dwa",level:3},{value:"Layer 2: Collaboration (ROS 2 Integration)",id:"layer-2-collaboration-ros-2-integration",level:2},{value:"2.1 Nav2 ROS 2 Topics",id:"21-nav2-ros-2-topics",level:3},{value:"2.2 Nav2 Configuration Structure",id:"22-nav2-configuration-structure",level:3},{value:"2.3 Launch Nav2",id:"23-launch-nav2",level:3},{value:"Layer 3: Intelligence (Tuning and Optimization)",id:"layer-3-intelligence-tuning-and-optimization",level:2},{value:"3.1 Costmap Tuning",id:"31-costmap-tuning",level:3},{value:"3.2 Planner Selection",id:"32-planner-selection",level:3},{value:"3.3 Local Controller Tuning",id:"33-local-controller-tuning",level:3},{value:"3.4 Debugging Planning Failures",id:"34-debugging-planning-failures",level:3},{value:"Layer 4: Advanced",id:"layer-4-advanced",level:2},{value:"4.1 Behavior Trees for Mission Control",id:"41-behavior-trees-for-mission-control",level:3},{value:"4.2 Custom Global Planner Plugin",id:"42-custom-global-planner-plugin",level:3},{value:"Summary",id:"summary",level:2},{value:"Code Examples",id:"code-examples",level:2},{value:"Example 1: Nav2 Configuration for Differential Drive",id:"example-1-nav2-configuration-for-differential-drive",level:3},{value:"Example 2: Goal Publisher",id:"example-2-goal-publisher",level:3},{value:"Practice Exercise",id:"practice-exercise",level:2},{value:"References",id:"references",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"lesson-4-nav2-path-planning-stack",children:"Lesson 4: Nav2 Path Planning Stack"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Duration"}),": 3 hours | ",(0,r.jsx)(e.strong,{children:"Level"}),": Unlimited | ",(0,r.jsx)(e.strong,{children:"Priority"}),": P1 | ",(0,r.jsx)(e.strong,{children:"Prerequisite"}),": Lesson 1"]}),"\n",(0,r.jsx)(e.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,r.jsx)(e.p,{children:"By the end of this lesson, you will be able to:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Explain"})," Nav2 architecture and the multi-level planning approach"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Configure"})," costmaps with static, obstacle, and inflation layers"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Understand"})," global planner algorithms (RRT, Theta*, graph-based) and their trade-offs"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Implement"})," local trajectory planning with dynamic window approach (DWA)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Tune"})," Nav2 parameters for different robot types and environments"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Debug"})," planning failures using RViz and diagnostics"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"layer-1-foundation",children:"Layer 1: Foundation"}),"\n",(0,r.jsx)(e.h3,{id:"41-navigation-pipeline-overview",children:"4.1 Navigation Pipeline Overview"}),"\n",(0,r.jsx)(e.p,{children:"Autonomous navigation requires solving the path planning problem at multiple time scales:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Goal: Robot must reach destination while avoiding obstacles\n\n\u250c\u2500 Global Planning (slow, far-looking)\n\u2502  \u251c\u2500 Input: Full occupancy grid, start, goal\n\u2502  \u251c\u2500 Output: Reference path through free space\n\u2502  \u251c\u2500 Frequency: 10-20 Hz (when goal changes)\n\u2502  \u2514\u2500 Horizon: Entire environment\n\u2502\n\u251c\u2500 Local Planning (fast, near-looking)\n\u2502  \u251c\u2500 Input: Local costmap, current pose\n\u2502  \u251c\u2500 Output: Velocity commands\n\u2502  \u251c\u2500 Frequency: 100 Hz\n\u2502  \u2514\u2500 Horizon: 1-5 meters\n\u2502\n\u2514\u2500 Control (lowest-level)\n   \u251c\u2500 Input: Velocity commands\n   \u251c\u2500 Output: Motor commands\n   \u2514\u2500 Frequency: 1000+ Hz\n"})}),"\n",(0,r.jsx)(e.h3,{id:"42-the-nav2-stack",children:"4.2 The Nav2 Stack"}),"\n",(0,r.jsx)(e.p,{children:"Nav2 (Navigation2) is the ROS 2 standard navigation framework:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Nav2 Components:\n\u251c\u2500 Costmap2D (static + dynamic obstacle representation)\n\u251c\u2500 GlobalPlanner (compute path from start to goal)\n\u251c\u2500 LocalPlanner (generate safe velocity commands)\n\u251c\u2500 BehaviorTree (high-level mission orchestration)\n\u251c\u2500 Recovery behaviors (stuck detection + recovery)\n\u2514\u2500 Lifecycle manager (startup/shutdown coordination)\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Why multi-level?"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Efficiency"}),": Global planner doesn't need to run every millisecond"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Responsiveness"}),": Local planner reacts to dynamic obstacles quickly"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Robustness"}),": If local planner fails, recovery behaviors activate"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"43-costmap-representation",children:"4.3 Costmap Representation"}),"\n",(0,r.jsxs)(e.p,{children:["A ",(0,r.jsx)(e.strong,{children:"costmap"})," encodes navigable vs. non-navigable space:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Occupancy grid:\n[0] = free space (white)\n[254] = occupied (black)\n[255] = unknown (gray)\n\nBut costmaps add gradients for safety:\n0-50: Free space\n51-127: Cautionary region (approaching obstacles)\n128-252: Lethal region (collision likely)\n254: Unknown\n255: Lethal (definite obstacle)\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Three-layer costmap architecture"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Layer 1: Static map layer\n\u251c\u2500 Loaded from map file (.pgm)\n\u251c\u2500 Represents permanent obstacles\n\u2514\u2500 Never changes during execution\n\nLayer 2: Obstacle layer\n\u251c\u2500 Populated from sensor data (LiDAR, camera)\n\u251c\u2500 Detects dynamic obstacles\n\u2514\u2500 Updated every sensor frame\n\nLayer 3: Inflation layer\n\u251c\u2500 Expands obstacles by robot radius\n\u251c\u2500 Creates safety margin\n\u251c\u2500 Inflated obstacles prevent collision with sharp edges\n\u2514\u2500 Inflation_radius = robot_radius + safety_margin\n"})}),"\n",(0,r.jsx)(e.h3,{id:"44-global-planning-algorithms",children:"4.4 Global Planning Algorithms"}),"\n",(0,r.jsx)(e.h4,{id:"rrt-rapidly-exploring-random-tree",children:"RRT (Rapidly-Exploring Random Tree)"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"1. Start with tree containing only start position\n2. Loop:\n   a. Sample random point in space\n   b. Find nearest node in tree\n   c. Extend tree toward sampled point\n   d. If new node valid (no collision), add to tree\n   e. Check if goal reached\n3. When goal found, backtrack to get path\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Advantages"}),": Works in complex, high-dimensional spaces\n",(0,r.jsx)(e.strong,{children:"Disadvantages"}),": Path may be suboptimal, non-deterministic"]}),"\n",(0,r.jsx)(e.h4,{id:"rrt-rrt-star",children:"RRT* (RRT-Star)"}),"\n",(0,r.jsx)(e.p,{children:"Improvement over RRT:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Same as RRT, but with optimization:\nc. After extending, check nearby nodes\nd. Rewire: If path through new node shorter, update\ne. Gradually optimizes path as algorithm runs\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Advantage"}),": Asymptotically optimal path\n",(0,r.jsx)(e.strong,{children:"Disadvantage"}),": More computation per iteration"]}),"\n",(0,r.jsx)(e.h4,{id:"theta-theta-star",children:"Theta* (Theta-Star)"}),"\n",(0,r.jsx)(e.p,{children:"Graph-based planner with line-of-sight optimization:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"1. Discretize environment into grid\n2. Build graph with grid cells as nodes\n3. Use A* search to find shortest path\n4. Post-process: Check if line-of-sight shortcuts exist\n5. Use shortcuts if valid\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Advantages"}),": Deterministic, smooth paths, fast\n",(0,r.jsx)(e.strong,{children:"Disadvantages"}),": Grid-dependent, may miss narrow passages"]}),"\n",(0,r.jsx)(e.h3,{id:"45-local-planning-dynamic-window-approach-dwa",children:"4.5 Local Planning: Dynamic Window Approach (DWA)"}),"\n",(0,r.jsx)(e.p,{children:"DWA generates safe velocity commands by evaluating trajectories:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"DWA Algorithm:\n1. Current state: position, velocity\n2. Predict robot motion for 0.5-1.0 seconds with various velocities\n3. For each predicted trajectory:\n   a. Calculate distance to obstacles\n   b. Calculate progress toward goal\n   c. Compute trajectory cost (weighted sum)\n4. Select lowest-cost trajectory\n5. Execute first velocity command\n6. Repeat next cycle\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Why it works"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Considers dynamic constraints (max acceleration, velocity limits)"}),"\n",(0,r.jsx)(e.li,{children:"Naturally handles narrow spaces (curves if needed)"}),"\n",(0,r.jsx)(e.li,{children:"Runs at 100+ Hz for reactive obstacle avoidance"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"layer-2-collaboration-ros-2-integration",children:"Layer 2: Collaboration (ROS 2 Integration)"}),"\n",(0,r.jsx)(e.h3,{id:"21-nav2-ros-2-topics",children:"2.1 Nav2 ROS 2 Topics"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Topic"}),(0,r.jsx)(e.th,{children:"Type"}),(0,r.jsx)(e.th,{children:"Direction"}),(0,r.jsx)(e.th,{children:"Purpose"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"/map"})}),(0,r.jsx)(e.td,{children:"nav_msgs/OccupancyGrid"}),(0,r.jsx)(e.td,{children:"Out"}),(0,r.jsx)(e.td,{children:"Static occupancy grid"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"/costmap/costmap"})}),(0,r.jsx)(e.td,{children:"nav_msgs/OccupancyGrid"}),(0,r.jsx)(e.td,{children:"Out"}),(0,r.jsx)(e.td,{children:"Combined costmap"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"/move_base/global_plan"})}),(0,r.jsx)(e.td,{children:"nav_msgs/Path"}),(0,r.jsx)(e.td,{children:"Out"}),(0,r.jsx)(e.td,{children:"Planned path from start to goal"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"/move_base/local_plan"})}),(0,r.jsx)(e.td,{children:"nav_msgs/Path"}),(0,r.jsx)(e.td,{children:"Out"}),(0,r.jsx)(e.td,{children:"Local path (next 1-2m)"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"/goal_pose"})}),(0,r.jsx)(e.td,{children:"geometry_msgs/PoseStamped"}),(0,r.jsx)(e.td,{children:"In"}),(0,r.jsx)(e.td,{children:"Navigation goal"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"/cmd_vel"})}),(0,r.jsx)(e.td,{children:"geometry_msgs/Twist"}),(0,r.jsx)(e.td,{children:"Out"}),(0,r.jsx)(e.td,{children:"Velocity commands"})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"22-nav2-configuration-structure",children:"2.2 Nav2 Configuration Structure"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'# nav2_config.yaml\nnav2_bringup:\n  bt_xml_filename: "navigate_w_replanning_and_recovery.xml"  # behavior tree\n  use_lifecycle_mgr: true\n\n  planner_server:\n    ros__parameters:\n      expected_planner_frequency: 20.0  # Hz\n      plugins: ["GridBased"]\n      GridBased:\n        plugin: "nav2_navfn_planner/NavfnPlanner"\n        tolerance: 0.5  # distance to goal before success\n        use_astar: true  # use A* instead of Dijkstra\n\n  controller_server:\n    ros__parameters:\n      expected_controller_frequency: 20.0  # Hz\n      plugins: ["FollowPath"]\n      FollowPath:\n        plugin: "nav2_regulated_pure_pursuit_controller/RegulatedPurePursuitController"\n        desired_linear_vel: 0.5  # m/s\n        max_angular_vel: 1.57  # rad/s (~90 deg/s)\n\n  costmap:\n    costmap:\n      ros__parameters:\n        update_frequency: 5.0  # Hz\n        publish_frequency: 2.0  # Hz\n        global_frame: map\n        robot_base_frame: base_link\n        use_sim_time: true\n\n        plugins: ["static_layer", "obstacle_layer", "inflation_layer"]\n\n        static_layer:\n          plugin: "nav2_costmap_2d::StaticLayer"\n          map_subscribe_transient_local: true\n\n        obstacle_layer:\n          plugin: "nav2_costmap_2d::ObstacleLayer"\n          enabled: true\n          observation_sources: scan\n          scan:\n            topic: /scan  # LiDAR topic\n            max_obstacle_height: 2.0\n            obstacle_max_range: 2.5\n            obstacle_min_range: 0.0\n            raytrace_max_range: 3.0\n\n        inflation_layer:\n          plugin: "nav2_costmap_2d::InflationLayer"\n          inflation_radius: 0.55  # expand obstacles by 0.55m\n          cost_scaling_factor: 10.0  # slope of inflation gradient\n'})}),"\n",(0,r.jsx)(e.h3,{id:"23-launch-nav2",children:"2.3 Launch Nav2"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# nav2_launch.py\nimport launch\nfrom launch_ros.actions import Node\nfrom ament_index_python.packages import get_package_share_directory\n\ndef generate_launch_description():\n    # Get package directory\n    nav2_bringup_dir = get_package_share_directory('nav2_bringup')\n\n    # Load configuration file\n    nav2_config = os.path.join(nav2_bringup_dir, 'nav2_params.yaml')\n\n    # Create launch description\n    ld = launch.LaunchDescription()\n\n    # Start Nav2 bringup\n    ld.add_action(\n        Node(\n            package='nav2_bringup',\n            executable='bringup_launch.py',\n            arguments=[\n                '--use_sim_time', 'true',\n                '--params_file', nav2_config,\n            ],\n        )\n    )\n\n    return ld\n"})}),"\n",(0,r.jsx)(e.h2,{id:"layer-3-intelligence-tuning-and-optimization",children:"Layer 3: Intelligence (Tuning and Optimization)"}),"\n",(0,r.jsx)(e.h3,{id:"31-costmap-tuning",children:"3.1 Costmap Tuning"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Parameter"}),(0,r.jsx)(e.th,{children:"Effect"}),(0,r.jsx)(e.th,{children:"Typical Value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"inflation_radius"})}),(0,r.jsx)(e.td,{children:"Safety distance around obstacles"}),(0,r.jsx)(e.td,{children:"0.5-1.0m"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"cost_scaling_factor"})}),(0,r.jsx)(e.td,{children:"Gradient steepness"}),(0,r.jsx)(e.td,{children:"5-20"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"update_frequency"})}),(0,r.jsx)(e.td,{children:"How often costmap updates"}),(0,r.jsx)(e.td,{children:"5-10 Hz"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"obstacle_max_range"})}),(0,r.jsx)(e.td,{children:"Sensor range for obstacles"}),(0,r.jsx)(e.td,{children:"2.5-5.0m"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"raytrace_max_range"})}),(0,r.jsx)(e.td,{children:"Clear cells beyond this distance"}),(0,r.jsx)(e.td,{children:"3.0-6.0m"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Tuning strategy"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Start with large ",(0,r.jsx)(e.code,{children:"inflation_radius"})," (conservative)"]}),"\n",(0,r.jsx)(e.li,{children:"Reduce if robot can navigate tight spaces"}),"\n",(0,r.jsxs)(e.li,{children:["Increase ",(0,r.jsx)(e.code,{children:"cost_scaling_factor"})," if robot hugs obstacles too closely"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"32-planner-selection",children:"3.2 Planner Selection"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Planner"}),(0,r.jsx)(e.th,{children:"Best For"}),(0,r.jsx)(e.th,{children:"Speed"}),(0,r.jsx)(e.th,{children:"Optimality"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"NavFn (Dijkstra)"})}),(0,r.jsx)(e.td,{children:"Familiar layouts, real-time"}),(0,r.jsx)(e.td,{children:"Fast"}),(0,r.jsx)(e.td,{children:"Suboptimal"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsxs)(e.td,{children:[(0,r.jsx)(e.strong,{children:"Theta"}),"*"]}),(0,r.jsx)(e.td,{children:"Smooth paths, open spaces"}),(0,r.jsx)(e.td,{children:"Medium"}),(0,r.jsx)(e.td,{children:"Near-optimal"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"RRT"})}),(0,r.jsx)(e.td,{children:"Complex obstacles"}),(0,r.jsx)(e.td,{children:"Slow"}),(0,r.jsx)(e.td,{children:"Varies"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsxs)(e.td,{children:[(0,r.jsx)(e.strong,{children:"RRT"}),"*"]}),(0,r.jsx)(e.td,{children:"Guaranteed optimality"}),(0,r.jsx)(e.td,{children:"Very Slow"}),(0,r.jsx)(e.td,{children:"Optimal"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Recommendation"}),": Use Theta* for balance of speed and quality"]}),"\n",(0,r.jsx)(e.h3,{id:"33-local-controller-tuning",children:"3.3 Local Controller Tuning"}),"\n",(0,r.jsx)(e.p,{children:"For Regulated Pure Pursuit (common local planner):"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"RegulatedPurePursuitController:\n  desired_linear_vel: 0.5  # Target velocity\n  lookahead_dist: 0.6  # How far ahead to aim\n  min_approach_linear_vel: 0.05  # Slow down approaching goal\n  max_allowed_time_to_collision_up_to_carrot: 1.0  # Emergency stop time\n  use_velocity_scaled_lookahead_dist: true  # Adaptive lookahead\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Tuning"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Increase ",(0,r.jsx)(e.code,{children:"desired_linear_vel"})," for faster navigation"]}),"\n",(0,r.jsxs)(e.li,{children:["Increase ",(0,r.jsx)(e.code,{children:"lookahead_dist"})," for smoother paths (but less responsive)"]}),"\n",(0,r.jsxs)(e.li,{children:["Decrease ",(0,r.jsx)(e.code,{children:"max_allowed_time_to_collision_up_to_carrot"})," for faster reaction"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"34-debugging-planning-failures",children:"3.4 Debugging Planning Failures"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:'Issue: "No path found"'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Check: Is goal in free space? (use costmap viewer)"}),"\n",(0,r.jsx)(e.li,{children:"Solution: Ensure inflation_radius not too large"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Issue: Robot oscillates near goal"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Check: ",(0,r.jsx)(e.code,{children:"min_approach_linear_vel"})," too high"]}),"\n",(0,r.jsx)(e.li,{children:"Solution: Decrease to 0.05 or lower"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Issue: Planner too slow"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Check: Environment too large or planner too conservative"}),"\n",(0,r.jsx)(e.li,{children:"Solution: Switch to faster planner (Theta* vs. RRT)"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"layer-4-advanced",children:"Layer 4: Advanced"}),"\n",(0,r.jsx)(e.h3,{id:"41-behavior-trees-for-mission-control",children:"4.1 Behavior Trees for Mission Control"}),"\n",(0,r.jsx)(e.p,{children:"Nav2 uses behavior trees (BT) for high-level logic:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'\x3c!-- navigate_w_replanning_and_recovery.xml --\x3e\n<root main_tree_to_execute="MainTree">\n  <BehaviorTree ID="MainTree">\n    <Sequence name="root">\n      \x3c!-- Compute path --\x3e\n      <ComputePath name="compute_path" goal="{goal}" path="{path}" planner_id="GridBased"/>\n\n      \x3c!-- Follow path with replanning --\x3e\n      <FollowPath name="follow_path" path="{path}" controller_id="FollowPath"/>\n    </Sequence>\n  </BehaviorTree>\n</root>\n'})}),"\n",(0,r.jsx)(e.p,{children:"Behavior trees enable:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Replanning when path becomes invalid"}),"\n",(0,r.jsx)(e.li,{children:"Recovery behaviors (rotate, backup)"}),"\n",(0,r.jsx)(e.li,{children:"Goal switching without recompilation"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"42-custom-global-planner-plugin",children:"4.2 Custom Global Planner Plugin"}),"\n",(0,r.jsx)(e.p,{children:"Extend Nav2 with custom planning algorithm:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-cpp",children:'// custom_planner.hpp\n#include "nav2_core/global_planner.hpp"\n\nclass CustomPlanner : public nav2_core::GlobalPlanner {\npublic:\n  void configure(\n    const rclcpp_lifecycle::LifecycleNode::WeakPtr & parent,\n    std::string name, std::shared_ptr<tf2_ros::Buffer> tf,\n    std::shared_ptr<nav2_costmap_2d::Costmap2DROS> costmap_ros) override;\n\n  nav_msgs::msg::Path createPlan(\n    const geometry_msgs::msg::PoseStamped & start,\n    const geometry_msgs::msg::PoseStamped & goal) override;\n};\n'})}),"\n",(0,r.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Concept"}),(0,r.jsx)(e.th,{children:"Key Insight"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Multi-level planning"})}),(0,r.jsx)(e.td,{children:"Global (slow, far) + Local (fast, reactive)"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Costmaps"})}),(0,r.jsx)(e.td,{children:"Three-layer: static + obstacles + inflation"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsxs)(e.td,{children:[(0,r.jsx)(e.strong,{children:"RRT/Theta"}),"*"]}),(0,r.jsx)(e.td,{children:"Different trade-offs between speed and optimality"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"DWA"})}),(0,r.jsx)(e.td,{children:"Evaluates trajectories, not just steering angles"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Tuning"})}),(0,r.jsx)(e.td,{children:"Start conservative, gradually loosen constraints"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,r.jsx)(e.h3,{id:"example-1-nav2-configuration-for-differential-drive",children:"Example 1: Nav2 Configuration for Differential Drive"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'# nav2_differential_drive_config.yaml\nnav2_bringup:\n  planner_server:\n    ros__parameters:\n      plugins: ["GridBased"]\n      GridBased:\n        plugin: "nav2_navfn_planner/NavfnPlanner"\n        tolerance: 0.5\n        use_astar: true\n\n  controller_server:\n    ros__parameters:\n      plugins: ["FollowPath"]\n      FollowPath:\n        plugin: "nav2_regulated_pure_pursuit_controller/RegulatedPurePursuitController"\n        desired_linear_vel: 0.5\n        max_angular_vel: 1.57\n        lookahead_dist: 0.6\n        use_velocity_scaled_lookahead_dist: true\n\n  costmap:\n    costmap:\n      ros__parameters:\n        robot_radius: 0.25\n        plugins: ["static_layer", "obstacle_layer", "inflation_layer"]\n        obstacle_layer:\n          observation_sources: scan\n          scan:\n            topic: /scan\n            max_obstacle_height: 2.0\n        inflation_layer:\n          inflation_radius: 0.55\n          cost_scaling_factor: 10.0\n'})}),"\n",(0,r.jsx)(e.h3,{id:"example-2-goal-publisher",children:"Example 2: Goal Publisher"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# nav2_goal_publisher.py\nimport rclpy\nfrom geometry_msgs.msg import PoseStamped\n\ndef publish_goal(x, y, yaw):\n    node = rclpy.create_node('goal_publisher')\n    pub = node.create_publisher(PoseStamped, '/goal_pose', 10)\n\n    goal = PoseStamped()\n    goal.header.frame_id = 'map'\n    goal.header.stamp = node.get_clock().now().to_msg()\n    goal.pose.position.x = x\n    goal.pose.position.y = y\n    goal.pose.orientation.z = sin(yaw/2)\n    goal.pose.orientation.w = cos(yaw/2)\n\n    pub.publish(goal)\n    print(f\"Goal published: ({x}, {y})\")\n"})}),"\n",(0,r.jsx)(e.h2,{id:"practice-exercise",children:"Practice Exercise"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Objective"}),": Configure Nav2 and navigate a robot to multiple waypoints"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Steps"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Create a Gazebo world with obstacles"}),"\n",(0,r.jsx)(e.li,{children:"Write a static map from Gazebo world"}),"\n",(0,r.jsx)(e.li,{children:"Configure Nav2 with provided YAML template"}),"\n",(0,r.jsx)(e.li,{children:"Launch Nav2 + robot simulator"}),"\n",(0,r.jsx)(e.li,{children:"Publish 5 goal poses sequentially"}),"\n",(0,r.jsxs)(e.li,{children:["Verify:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Costmap displays obstacles correctly"}),"\n",(0,r.jsx)(e.li,{children:"Robot plans paths around obstacles"}),"\n",(0,r.jsx)(e.li,{children:"Navigation completes in <10 seconds per goal"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Success criteria"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"All 5 goals reached successfully"}),"\n",(0,r.jsx)(e.li,{children:"Paths are smooth and collision-free"}),"\n",(0,r.jsx)(e.li,{children:"Nav2 diagnostics show no errors"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Nav2 Documentation"}),": ",(0,r.jsx)(e.a,{href:"https://navigation.ros.org/",children:"ROS 2 Nav2 Docs"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Path Planning Survey"}),": ",(0,r.jsx)(e.a,{href:"http://planning.cs.umn.edu/",children:"Motion Planning Survey (LaValle)"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"RRT Algorithm"}),": ",(0,r.jsx)(e.a,{href:"https://arxiv.org/abs/1105.1186",children:"Sampling-based Algorithms for Optimal Motion Planning"})]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(e.p,{children:"You now understand Nav2 path planning architecture and configuration. Choose your path:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsxs)(e.strong,{children:["\u2192 ",(0,r.jsx)(e.a,{href:"/physical-ai-robotics-textbook/docs/chapter-3-autonomous-navigation/obstacle-avoidance-and-dynamic-environments",children:"Lesson 5: Obstacle Avoidance"})]})," (Handle dynamic obstacles)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsxs)(e.strong,{children:["\u2192 ",(0,r.jsx)(e.a,{href:"/physical-ai-robotics-textbook/docs/chapter-3-autonomous-navigation/capstone-mission",children:"Lesson 8: Capstone"})]})," (Integrate full system)"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Lesson 4 Summary"}),": Nav2 provides a mature, ROS 2-native framework for autonomous navigation using multi-level planning (global + local). Understanding costmaps, planner algorithms, and parameter tuning enables you to deploy robust navigation in diverse environments."]})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8439:(n,e,a)=>{a.d(e,{R:()=>t,x:()=>l});var i=a(758);const r={},s=i.createContext(r);function t(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);